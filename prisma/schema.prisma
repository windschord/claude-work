// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// Repository model for managing local and remote repositories
model Repository {
  id            String    @id @default(uuid())
  name          String
  type          String    // "local" または "remote"
  path          String?   // ローカルパス（type=local時）
  url           String?   // リモートURL（type=remote時）
  defaultBranch String    @map("default_branch")
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")
  sessions      Session[]

  @@map("repositories")
}

// Session model for Docker container-based architecture
model Session {
  id           String     @id @default(uuid())
  name         String
  containerId  String?    @map("container_id")
  volumeName   String     @map("volume_name")
  repositoryId String     @map("repository_id")
  repository   Repository @relation(fields: [repositoryId], references: [id])
  worktreePath String?    @map("worktree_path")
  parentBranch String?    @map("parent_branch")
  branch       String
  status       String     @default("creating") // creating, running, stopped, error
  createdAt    DateTime   @default(now()) @map("created_at")
  updatedAt    DateTime   @updatedAt @map("updated_at")

  @@map("sessions")
}

// Keep Prompt model for prompt history feature
model Prompt {
  id           String   @id @default(uuid())
  content      String   @unique
  used_count   Int      @default(1)
  last_used_at DateTime @default(now())
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt
}
