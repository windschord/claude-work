# DEC-001: Docker環境をデフォルトにする理由

## ステータス
承認済み

## コンテキスト

プロジェクト登録時の保存場所選択において、ホスト環境とDocker環境のどちらをデフォルト値にするかを決定する必要がある。

### 背景
- ホスト環境の1Password SSH Agentとの通信失敗により、プロジェクト登録が失敗するケースがある
- Docker環境では既にSSH Agent転送が実装済みで正常動作している
- 新規ユーザーがSSH Agent問題に遭遇するリスクを低減する必要がある

## 決定事項

**プロジェクト登録フォームのデフォルト値をDocker環境にする。**

新規プロジェクトのデフォルトcloneLocationは'docker'とする。

## 理由

### 1. SSH Agent問題の初期回避

**問題**:
- ホスト環境の1Password SSH Agentとの通信失敗が発生する
- 新規ユーザーがいきなりエラーに遭遇すると、ClaudeWorkの使用を諦める可能性がある

**Docker環境のメリット**:
- SSH Agent転送が既に実装済みで正常動作
- 認証問題に遭遇するリスクを大幅に低減

### 2. 初心者に優しい

**ホスト環境の課題**:
- SSH鍵の設定が適切でない場合、エラーが発生
- 1Password SSH Agentなどのツールとの相性問題

**Docker環境の利点**:
- Dockerが正しく設定されていれば、ほぼ確実に動作
- SSH Agent転送により、認証情報が適切にマウントされる

### 3. ユーザーの回答に基づく

ユーザーからの明示的な要望:
> UIデフォルトはDocker環境（SSH Agent問題を初期回避）

### 4. ホスト環境も引き続き利用可能

**重要**: Docker環境をデフォルトにしても、ユーザーは明示的にホスト環境を選択できる。

**ホスト環境を選択する理由**:
- Docker環境が利用できない
- ホスト環境の方が高速（Dockerのオーバーヘッドがない）
- ホスト環境で問題なく動作している既存ユーザー

## 代替案

### 案A: ホスト環境をデフォルトにする
**メリット**:
- 既存の実装と一貫性がある
- Dockerのオーバーヘッドがない

**デメリット**:
- SSH Agent問題に遭遇するリスクが高い
- 新規ユーザーがエラーに遭遇する可能性

**却下理由**: SSH Agent問題を回避することが今回のプロジェクトの主要な目的であるため。

### 案B: ユーザーに選択を強制する（デフォルトなし）
**メリット**:
- ユーザーが明示的に選択するため、意識的な決定

**デメリット**:
- UIが複雑になる
- 新規ユーザーが判断に迷う

**却下理由**: 初心者に優しくないため。

## 影響

### ポジティブ
- 新規ユーザーがSSH Agent問題に遭遇するリスクが低減
- プロジェクト登録の成功率が向上
- ユーザーエクスペリエンスが向上

### ネガティブ
- Docker環境が利用できないユーザーは、手動でホスト環境を選択する必要がある
- Docker環境でのcloneは、ホスト環境より若干遅い（初回イメージpullを含む）

### リスク緩和
- UIにホスト環境の選択肢を明確に表示
- Docker環境が利用できない場合のエラーメッセージを改善
- ドキュメントにデフォルト値の理由を明記

## 実装

### データベーススキーマ
```prisma
model Project {
  // ...
  cloneLocation String? @default("docker")
  // ...
}
```

### UI実装
- プロジェクト登録フォームで Docker環境をデフォルト選択
- ホスト環境も明確に表示し、選択可能にする

## 注記

### 既存プロジェクトの扱い
既存プロジェクト（cloneLocationが未定義）はすべてホスト環境として扱う。これは既存ユーザーへの影響を最小限に抑えるため。

### 将来の改善
- Docker環境の設定が不適切な場合、自動的にホスト環境にフォールバックする機能
- ユーザーごとのデフォルト値設定機能

## 参照

- requirements/index.md: スコープと目的
- requirements/stories/US-001.md: プロジェクト登録時の保存場所選択
- requirements/nfr/security.md: セキュリティ要件
