# タスク: JSON表示問題の修正

## 逆順レビュー結果

| チェック | 結果 |
|----------|------|
| タスク → 設計 | 整合 |
| 設計 → 要件 | 整合 |

## 実装計画

### フェーズ1: テスト作成

#### タスク1.1: userタイプ無視のテスト作成

**説明**:
- 対象ファイル: `src/services/__tests__/process-manager.test.ts`
- `'user'`タイプのメッセージが`output`イベントを発火しないことをテスト

**実装手順（TDD）**:
1. テスト作成: `handleStreamJsonMessage`が`'user'`タイプで`output`を発火しないテスト
2. テスト実行: 失敗を確認
3. テストコミット

**受入基準**:
- [ ] `'user'`タイプのメッセージが`output`イベントを発火しないことをテスト
- [ ] テストが失敗することを確認

**依存関係**: なし
**推定工数**: 10分
**ステータス**: `TODO`

---

#### タスク1.2: 認識されないタイプ無視のテスト作成

**説明**:
- 対象ファイル: `src/services/__tests__/process-manager.test.ts`
- 認識されないメッセージタイプが`output`イベントを発火しないことをテスト

**実装手順（TDD）**:
1. テスト作成: `handleStreamJsonMessage`が`'unknown'`タイプで`output`を発火しないテスト
2. テスト実行: 失敗を確認
3. テストコミット（タスク1.1と合わせて）

**受入基準**:
- [ ] 認識されないタイプが`output`イベントを発火しないことをテスト
- [ ] テストが失敗することを確認

**依存関係**: タスク1.1
**推定工数**: 5分
**ステータス**: `TODO`

---

### フェーズ2: 実装

#### タスク2.1: process-manager.tsの修正

**説明**:
- 対象ファイル: `src/services/process-manager.ts`
- `handleStreamJsonMessage`メソッド（312-396行目）を修正

**修正内容**:
1. `'user'`タイプ用のcaseを追加（`logger.debug`でログ出力、`output`イベントは発火しない）
2. `default`ケースを修正（`logger.debug`でログ出力、`output`イベントは発火しない）

**実装手順**:
1. `case 'user':`を追加
2. `default:`を修正
3. テスト実行: 全テスト通過を確認
4. 実装コミット

**受入基準**:
- [ ] `case 'user':`が追加されている
- [ ] `default`ケースが`output`を発火しない
- [ ] `npm test`で全テスト通過
- [ ] ESLintエラーがゼロ

**依存関係**: タスク1.1、タスク1.2
**推定工数**: 10分
**ステータス**: `TODO`

---

### フェーズ3: 動作確認

#### タスク3.1: ブラウザでの動作確認

**説明**:
- セッション画面でJSONが表示されなくなったことを確認

**確認手順**:
1. `npx claude-work start`でサーバー起動
2. セッション画面でClaude Codeにメッセージ送信
3. JSON文字列が表示されないことを確認

**受入基準**:
- [ ] チャット画面にJSON文字列が表示されない
- [ ] アシスタントの応答テキストが正しく表示される

**依存関係**: タスク2.1
**推定工数**: 5分
**ステータス**: `TODO`

---

## タスクステータスの凡例

- `TODO` - 未着手
- `IN_PROGRESS` - 作業中
- `DONE` - 完了
