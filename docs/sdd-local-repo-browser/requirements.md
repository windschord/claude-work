# ローカルGitリポジトリブラウザ - 要件定義書

## 概要

Dockerセッション作成時に、リモートURLの手入力に加えて、ローカルファイルシステム上のGitリポジトリをGUIで選択できる機能を提供する。

## ユーザーストーリー

### US-001: ローカルリポジトリからセッションを作成したい

**ペルソナ**: 開発者
**目的**: 既存のローカルGitリポジトリを使用してDockerセッションを作成する
**価値**: リモートURLを手入力する手間を省き、ローカル開発環境との連携を容易にする

**受入基準**:
- [ ] セッション作成モーダルでソースタイプ（リモート/ローカル）を選択できる
- [ ] ローカル選択時、ファイルブラウザでディレクトリを探索できる
- [ ] Gitリポジトリ（.gitディレクトリを含む）のみが選択可能
- [ ] 選択したリポジトリでセッションを作成できる

---

## 機能要件

### REQ-001: ソースタイプ切り替え

セッション作成モーダルを開いた時、システムは「リモートURL」と「ローカルリポジトリ」のソースタイプを切り替えるUIを表示しなければならない。

**詳細**:
- デフォルトは「リモートURL」（既存の動作を維持）
- タブまたはラジオボタンで切り替え
- 切り替え時にフォーム内容をリセット

### REQ-002: ディレクトリ一覧API

ローカルリポジトリ選択モードにおいて、システムはサーバー側でディレクトリ一覧を取得するAPIを提供しなければならない。

**詳細**:
- エンドポイント: `GET /api/filesystem/browse`
- パラメータ: `path` (ディレクトリパス、省略時はホームディレクトリ)
- レスポンス: ディレクトリ一覧（名前、パス、タイプ、Gitリポジトリかどうか）

### REQ-003: Gitリポジトリ検出

ディレクトリ一覧取得時、システムは各ディレクトリがGitリポジトリかどうかを判定しなければならない。

**詳細**:
- `.git`ディレクトリまたは`.git`ファイルの存在でGitリポジトリと判定
- Gitリポジトリにはアイコンまたはバッジで視覚的に区別

### REQ-004: ディレクトリナビゲーション

ローカルリポジトリ選択UIにおいて、ユーザーがディレクトリをクリックした時、システムはそのディレクトリの内容を表示しなければならない。

**詳細**:
- ディレクトリをクリックでサブディレクトリに移動
- パンくずリストで現在位置を表示
- 親ディレクトリへの戻る機能

### REQ-005: リポジトリ選択

Gitリポジトリを選択した時、システムはそのパスをセッション作成フォームに設定しなければならない。

**詳細**:
- Gitリポジトリのみ選択ボタンが有効
- 選択後、パスが入力欄に表示される
- ブランチ一覧を自動取得（可能であれば）

### REQ-006: ボリュームマウント方式

ローカルリポジトリを選択してセッションを作成した時、システムはそのディレクトリをDockerコンテナにボリュームマウントしなければならない。

**詳細**:
- ローカルパスをコンテナの`/workspace`にマウント
- 読み書き可能（rw）でマウント
- 既存のボリューム作成・git clone処理をスキップ

---

## 非機能要件

### NFR-001: セキュリティ

ファイルシステムブラウザにおいて、システムはユーザーのホームディレクトリ配下のみアクセスを許可しなければならない。

**詳細**:
- ホームディレクトリ外へのパストラバーサルを防止
- シンボリックリンクの追跡は許可するが、結果がホームディレクトリ外の場合は拒否
- 隠しファイル（.で始まる）は表示するが、.gitを除き選択不可

### NFR-002: パフォーマンス

ディレクトリ一覧取得APIは、1000件以下のエントリに対して500ms以内に応答しなければならない。

**詳細**:
- 大規模ディレクトリでの遅延を防ぐためページネーションを検討
- 非同期読み込みでUIブロックを防止

### NFR-003: ユーザビリティ

ファイルブラウザは直感的に操作できなければならない。

**詳細**:
- キーボードナビゲーション対応
- ローディング状態の表示
- エラー時の明確なメッセージ

---

## 制約事項

1. **ブラウザ制限**: Webブラウザからホストのファイルシステムに直接アクセスできないため、サーバー側APIが必須
2. **Docker制限**: ボリュームマウントはDockerコンテナ起動時にのみ設定可能（動的な変更不可）
3. **パーミッション**: Dockerデーモンがアクセスできるディレクトリのみマウント可能

---

## 用語集

| 用語 | 定義 |
|------|------|
| ボリュームマウント | ホストのディレクトリをコンテナ内にマップする機能 |
| Gitリポジトリ | .gitディレクトリを含むディレクトリ |
| パストラバーサル | 許可されたディレクトリ外にアクセスする攻撃手法 |
