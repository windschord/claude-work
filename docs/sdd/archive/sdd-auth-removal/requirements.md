# 要件定義書: 認証機能（削除済み）

> **注記**: このドキュメントはアーカイブ目的で保存されています。
> 認証機能はストーリー28により削除されました。

## 概要

リモートアクセスと認証機能の要件を定義します。

## 関連ストーリー

- ストーリー10: リモートアクセスとセキュリティ **[削除]**
- ストーリー28: 認証機能の削除（シングルユーザー向け簡略化）

---

## ストーリー10: リモートアクセスとセキュリティ

> **注記**: このストーリーの要件は、ストーリー28（認証機能の削除）により無効化されました。

**私は** 開発者として
**〜したい** 外出先から安全にCrystal WebUIにアクセス
**なぜなら** 場所を選ばず開発を続けたいから

### 受入基準（EARS記法）

以下の要件は **ストーリー28により削除** されました：

- ~~**REQ-054**: システムは認証なしでのアクセスを拒否しなければならない~~ **[削除]**
- ~~**REQ-055**: ユーザーがログインページにアクセスした時、システムはトークンベースの認証フォームを表示しなければならない~~ **[削除]**
- ~~**REQ-056**: 正しいトークンが入力された時、システムはセッションを開始し、ダッシュボードにリダイレクトしなければならない~~ **[削除]**
- ~~**REQ-057**: 認証済みセッションの有効期限が切れた時、システムはユーザーをログインページにリダイレクトしなければならない~~ **[削除]**

---

## ストーリー28: 認証機能の削除（シングルユーザー向け簡略化）

**私は** 開発者として
**〜したい** 認証なしでアプリケーションにアクセス
**なぜなら** シングルユーザー環境では認証は不要であり、利便性を優先したいから

### 背景

ClaudeWorkはホームラボ環境でシングルユーザーが使用することを想定している。認証機能はオーバーヘッドであり、削除することで以下の利点がある：
- ログイン手順の省略による利便性向上
- コードベースの簡略化
- メンテナンス負荷の軽減

### 受入基準（EARS記法）

**ストーリー10の要件を無効化:**
- ~~REQ-054: システムは認証なしでのアクセスを拒否しなければならない~~ **[削除]**
- ~~REQ-055: ユーザーがログインページにアクセスした時、システムはトークンベースの認証フォームを表示しなければならない~~ **[削除]**
- ~~REQ-056: 正しいトークンが入力された時、システムはセッションを開始し、ダッシュボードにリダイレクトしなければならない~~ **[削除]**
- ~~REQ-057: 認証済みセッションの有効期限が切れた時、システムはユーザーをログインページにリダイレクトしなければならない~~ **[削除]**

**NFR-005を無効化:**
- ~~NFR-005: システムは認証トークンをハッシュ化して保存しなければならない~~ **[削除]**

**新規要件:**
- **REQ-171**: ユーザーがアプリケーションのルートURL（/）にアクセスした時、システムは認証なしでホームページを表示しなければならない
- **REQ-172**: すべてのAPIエンドポイントにおいて、システムは認証チェックを行わず、リクエストを処理しなければならない
- **REQ-173**: すべてのWebSocketエンドポイントにおいて、システムは認証チェックを行わず、接続を許可しなければならない
- **REQ-174**: ヘッダーにおいて、システムはログアウトボタンを表示してはならない
- **REQ-175**: /loginページにアクセスした時、システムはホームページ（/）にリダイレクトしなければならない
- **REQ-176**: システムはAuthSessionテーブルを使用してはならない
- **REQ-177**: 環境変数CLAUDE_WORK_TOKENとSESSION_SECRETは、システムの起動に必須ではなくなる

### 削除対象コンポーネント

1. **フロントエンド**
   - `/login` ページ（`src/app/login/page.tsx`）
   - `AuthGuard` コンポーネント（`src/components/AuthGuard.tsx`）
   - ストアの認証関連状態（`isAuthenticated`, `token`, `sessionId`, `expiresAt`, `login`, `logout`, `checkAuth`）
   - ヘッダーのログアウトボタン

2. **バックエンド**
   - 認証API（`/api/auth/login`, `/api/auth/logout`, `/api/auth/check`）
   - 各APIルートの認証チェック処理
   - WebSocket認証ミドルウェア
   - `src/lib/auth.ts` の認証関連関数

3. **データベース**
   - `AuthSession` テーブル（Prismaスキーマから削除）

4. **環境変数**
   - `CLAUDE_WORK_TOKEN`（必須ではなくなる）
   - `SESSION_SECRET`（必須ではなくなる）
