# 要件定義: Prisma 7 アップグレード

## 概要

Prisma ORM を 5.22.0 から 7.x にアップグレードする。Prisma 7 は Rust エンジンを廃止し、TypeScript ベースの新アーキテクチャを採用している。

## 背景

### Prisma 7 の主な変更点

1. **ドライバーアダプター必須**: データベース接続にアダプターが必要
2. **新設定ファイル**: `prisma.config.ts` でデータソースURL等を管理
3. **生成先変更**: クライアントを `node_modules` 外に生成
4. **インポートパス変更**: `@prisma/client` から生成先パスに変更

### 現状

- Prisma 5.22.0 使用
- SQLite データベース
- `@prisma/client` からインポート
- `schema.prisma` 内で `DATABASE_URL` を参照

## ユーザーストーリー

### ストーリー1: 最新 Prisma での開発

**私は** 開発者として
**〜したい** 最新の Prisma 7 を使用したい
**なぜなら** パフォーマンス改善とモダンなアーキテクチャの恩恵を受けたいから

#### 受入基準（EARS記法）

- **REQ-001**: `prisma generate` を実行した時、システムは Prisma 7 のクライアントを生成しなければならない
- **REQ-002**: アプリケーションが起動する時、システムは SQLite アダプター経由でデータベースに接続しなければならない
- **REQ-003**: 既存のデータベース操作が実行される時、システムは従来と同じ結果を返さなければならない

## 非機能要件

### 互換性要件

- **NFR-001**: アップグレードは既存のデータベースファイル（`data/claudework.db`）に影響を与えてはならない
- **NFR-002**: 既存のAPIエンドポイントの動作は変更されてはならない
- **NFR-003**: 開発環境（`pnpm run dev`）と本番環境（`npx claude-work`）の両方で動作しなければならない

### 最小要件

- **NFR-004**: Node.js 20.19.0 以上が必要
- **NFR-005**: TypeScript 5.4.0 以上が必要

## 依存関係

### 追加パッケージ

- `@prisma/adapter-better-sqlite3`: SQLite アダプター
- `better-sqlite3`: SQLite ドライバー（アダプターの依存）

### バージョン更新

- `prisma`: 5.22.0 → 7.x
- `@prisma/client`: 5.22.0 → 7.x

## スコープ外

- データベースのマイグレーション（スキーマ変更なし）
- ESM 完全移行（CommonJS 互換を維持）
- Turso/libSQL への移行
