# US-003: 設定の即時適用

## ユーザーストーリー

**私は** ClaudeWorkの管理者として
**〜したい** ポートマッピング・ボリュームマウントの設定変更を実行中のセッションに即座に適用
**なぜなら** 設定変更のためにセッションを手動で停止・再作成する手間を省きたいため

## 受入基準（EARS記法）

### デフォルト動作（次回起動時に反映）

- REQ-201: ユーザーが環境設定を変更して保存した時、システムは設定をDBに保存しなければならない
- REQ-202: ユーザーが環境設定を変更して保存した時、システムは既存の実行中セッションを停止してはならない
- REQ-203: ユーザーが設定変更後に新しいセッションを作成した時、システムは変更後の設定でコンテナを起動しなければならない
- REQ-204: ユーザーが設定変更後に既存セッションを再起動した時、システムは変更後の設定でコンテナを起動しなければならない

### 即時適用オプション

- REQ-205: ユーザーが環境設定を変更して保存した時、もし該当環境を使用している実行中のセッションが存在する場合、システムは「今すぐ適用」ボタンを表示しなければならない
- REQ-206: ユーザーが「今すぐ適用」ボタンをクリックした時、システムは確認ダイアログを表示しなければならない
- REQ-207: 確認ダイアログにおいて、ユーザーが「適用」を選択した時、システムは該当環境を使用している全ての実行中セッションのコンテナを停止し、新しい設定でコンテナを再作成しなければならない
- REQ-208: コンテナ再作成中、システムは対象セッションのステータスを「再起動中」と表示しなければならない
- REQ-209: コンテナ再作成が完了した時、システムは対象セッションのステータスを「実行中」に更新しなければならない
- REQ-210: もしコンテナ再作成に失敗した場合、システムはエラーメッセージを表示し、セッションのステータスを「エラー」に更新しなければならない

### 影響範囲の表示

- REQ-211: 環境設定編集時に実行中セッションが存在する場合、システムは影響を受けるセッション数を表示しなければならない
- REQ-212: 確認ダイアログにおいて、システムは影響を受けるセッションの一覧（セッション名）を表示しなければならない

## 優先度

中

## ステータス

完了
