# US-001: ポートマッピングの設定

## ユーザーストーリー

**私は** ClaudeWorkの管理者として
**〜したい** Docker環境にポートマッピングを追加・削除
**なぜなら** Docker環境内で起動した開発サーバーやアプリケーションにホストからアクセスする必要があるため

## 受入基準（EARS記法）

### 環境作成時

- REQ-001: ユーザーがDocker環境の作成フォームを開いた時、システムはポートマッピング設定セクションを表示しなければならない
- REQ-002: ユーザーが「ポートを追加」ボタンをクリックした時、システムはホストポート、コンテナポート、プロトコル（TCP/UDP）の入力行を追加しなければならない
- REQ-003: ユーザーがポートマッピング行の削除ボタンをクリックした時、システムは該当行を削除しなければならない
- REQ-004: ユーザーが環境を作成した時、システムは設定したポートマッピングをconfig JSONの`portMappings`フィールドに保存しなければならない

### 環境編集時

- REQ-005: ユーザーが既存のDocker環境の編集フォームを開いた時、システムは保存済みのポートマッピング設定を復元して表示しなければならない
- REQ-006: ユーザーが編集フォームでポートマッピングを追加・削除して保存した時、システムはconfig JSONの`portMappings`フィールドを更新しなければならない

### バリデーション

- REQ-007: ユーザーがホストポートに1〜65535の範囲外の値を入力した時、システムはバリデーションエラーを表示しなければならない
- REQ-008: ユーザーがコンテナポートに1〜65535の範囲外の値を入力した時、システムはバリデーションエラーを表示しなければならない
- REQ-009: ユーザーが同一ホストポート・プロトコルの組み合わせを重複して設定した時、システムは重複エラーを表示しなければならない
- REQ-010: もしホストポートまたはコンテナポートが空の場合、システムは環境の保存を拒否しなければならない

### docker run への反映

- REQ-011: Docker環境でセッションを作成した時、システムは設定された各ポートマッピングを`-p {hostPort}:{containerPort}/{protocol}`形式でdocker runコマンドに追加しなければならない
- REQ-012: もしプロトコルが指定されていない場合、システムはデフォルトとしてTCPを使用しなければならない

## データ構造

### portMappingsの形式

```typescript
interface PortMapping {
  hostPort: number;        // ホスト側のポート番号
  containerPort: number;   // コンテナ側のポート番号
  protocol: 'tcp' | 'udp'; // プロトコル（省略時のデフォルト: 'tcp'）
}
```

### config JSONの例

```json
{
  "imageSource": "existing",
  "imageName": "ghcr.io/windschord/claude-work",
  "imageTag": "latest",
  "skipPermissions": false,
  "portMappings": [
    { "hostPort": 3000, "containerPort": 3000, "protocol": "tcp" },
    { "hostPort": 8080, "containerPort": 80, "protocol": "tcp" }
  ]
}
```

## 優先度

高

## ステータス

完了
