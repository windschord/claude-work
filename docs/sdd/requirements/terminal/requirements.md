# 要件定義書: ターミナル統合

## 概要

ターミナル統合機能（XTerm.js）およびターミナルサイズの自動調整機能の要件を定義します。

## 関連ストーリー

- ストーリー11: ターミナル統合
- ストーリー18: ターミナルサイズの自動調整

---

## ストーリー11: ターミナル統合

**私は** 開発者として
**〜したい** worktree内でターミナルを直接操作
**なぜなら** 細かい操作や確認作業を行いたいから

### 受入基準（EARS記法）

- **REQ-058**: ユーザーが「ターミナル」タブをクリックした時、システムはworktreeをカレントディレクトリとしたターミナルを表示しなければならない
- **REQ-059**: ターミナルにおいて、システムはXTerm.jsを使用した対話的なシェルを提供しなければならない
- **REQ-060**: ターミナルセッションにおいて、システムはユーザーの入力をサーバー側のPTYプロセスに送信しなければならない
- **REQ-061**: ターミナルにおいて、システムはANSIエスケープシーケンスを正しくレンダリングしなければならない
- **REQ-062**: ユーザーがセッションを切り替えた時（別セッションのタブを選択して戻った場合など）、システムはターミナルセッション（PTYプロセス）を維持し、出力履歴を保持しなければならない

---

## ストーリー18: ターミナルサイズの自動調整

**私は** 開発者として
**〜したい** ターミナルがウィンドウサイズに合わせて自動的にリサイズされること
**なぜなら** 固定サイズの小さいターミナルでは作業効率が悪く、手動でリサイズするのは面倒だから

### 背景

- 現在、ターミナルは cols: 80, rows: 24 で固定されている
- ウィンドウサイズを変更してもターミナルサイズは変わらない
- XTerm.js のアドオンを使用することで、コンテナサイズに合わせた自動調整が可能

### 受入基準（EARS記法）

- **REQ-114**: ターミナルパネルが表示された時、システムはコンテナサイズに合わせてターミナルの行数・列数を自動計算しなければならない
- **REQ-115**: ウィンドウサイズが変更された時、システムは300ms以内にターミナルサイズを再計算しなければならない
- **REQ-116**: タブが切り替えられてターミナルが表示された時、システムはターミナルサイズを再計算しなければならない
- **REQ-117**: ターミナルサイズが変更された時、システムはWebSocket経由でサーバーにリサイズイベントを送信しなければならない
- **REQ-118**: ClaudeターミナルとShellターミナルの両方に対して、システムは同じリサイズ動作を適用しなければならない

---

## 非機能要件

### パフォーマンス

- **NFR-018**: ターミナルリサイズは300ms以内に完了しなければならない
