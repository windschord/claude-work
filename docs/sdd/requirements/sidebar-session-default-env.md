# 要件定義: サイドメニューセッション作成時のデフォルト環境バグ修正

## 概要

サイドメニューからセッションを作成する際、プロジェクトのデフォルト環境がDockerに設定されていてもHOST環境が選択されるバグを修正する。

## 背景

CreateSessionModalコンポーネントで、環境リストの取得とプロジェクト情報の取得が非同期で行われるが、環境リストが先に読み込まれた場合にデフォルト環境（HOST）が選ばれ、後からプロジェクトの環境設定が読み込まれても初期選択が更新されないレースコンディションが存在する。

## 要件

### REQ-001: プロジェクトのデフォルト環境が正しく初期選択される

サイドメニューからセッション作成モーダルを開いた時、プロジェクトに`environment_id`が設定されている場合は、その環境が初期選択されなければならない。

- **EARS記法**: プロジェクトに`environment_id`が設定されている時、システムはセッション作成モーダルにおいてそのプロジェクトの環境を初期表示しなければならない。

### REQ-002: 環境選択は両方のデータ取得完了後に行われる

セッション作成モーダルの環境選択UIは、環境リストとプロジェクト情報の両方の取得が完了するまで確定した選択状態を表示してはならない。

- **EARS記法**: 環境リストまたはプロジェクト情報の取得中、システムはローディング状態を表示しなければならない。

### REQ-003: プロジェクトに環境が未設定の場合のフォールバック

プロジェクトに`environment_id`が設定されていない場合は、従来通り`is_default`フラグのある環境が初期選択されなければならない。

- **EARS記法**: もしプロジェクトに`environment_id`が設定されていないならば、システムはデフォルト環境（`is_default=true`）を初期選択しなければならない。

## 非機能要件

### NFR-001: 既存テストへの影響なし

修正により既存のテストが破壊されてはならない。

### NFR-002: ユーザー体験の維持

ローディング表示の追加によるUX劣化を最小限に抑える。環境データが利用可能な場合は即座に表示する。

## 受入基準

- [ ] プロジェクトのデフォルト環境がDockerの場合、モーダルを開いた時にDocker環境が初期選択される
- [ ] プロジェクトのデフォルト環境がHOSTの場合、モーダルを開いた時にHOST環境が初期選択される
- [ ] プロジェクトに環境が設定されていない場合、is_defaultの環境が初期選択される
- [ ] 既存のユニットテストが全てパスする
- [ ] 新しいテストが追加され、レースコンディションが再発しないことが検証される
