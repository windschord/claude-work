# 非機能要件: 信頼性

## 概要

システムはエラー発生時も安定して動作し、データの一貫性を保たなければならない。

## 要件（EARS記法）

### エラーハンドリング

- **NFR-001**: worktreeディレクトリが存在しない場合、システムは適切なエラーメッセージを返し、処理を終了しなければならない
- **NFR-002**: git操作が失敗した時、システムはエラーをログに記録し、無限再試行してはならない
- **NFR-003**: PTY作成が失敗した時、システムはセッションステータスを`error`に更新しなければならない

### スタック保護

- **NFR-004**: git操作の再試行回数は3回以内でなければならない
- **NFR-005**: エラー発生時、システムは再帰呼び出しを避け、スタックオーバーフローを防止しなければならない

### データ整合性

- **NFR-006**: セッション作成が途中で失敗した時、システムは作成途中のworktreeを削除しなければならない
- **NFR-007**: セッション削除時、システムはworktreeディレクトリとデータベースレコードの両方を削除しなければならない

## 受入基準

- [ ] worktree不在エラーでサーバーがクラッシュしない
- [ ] git操作エラーが無限ループを引き起こさない
- [ ] エラー発生時も他のセッションが正常に動作する
- [ ] エラーログに十分な情報が記録される
