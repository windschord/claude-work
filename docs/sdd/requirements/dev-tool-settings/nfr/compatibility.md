# 互換性要件

> 非機能要件カテゴリ: 互換性

## 概要

開発ツール設定管理機能は、既存の ClaudeWork システムに追加される新機能であるため、既存機能への影響を最小限に抑え、後方互換性を保つ必要があります。

## 要件一覧

### NFR-COMP-001: 既存プロジェクト/セッションへの影響なし

**EARS記法**: もし開発ツール設定が未設定の場合、システムは既存のプロジェクトとセッションを変更なしで動作させなければならない

**測定基準**:
- 指標: 既存機能の動作確認
- 目標値: すべての既存機能が正常動作すること
- 測定方法:
  - リグレッションテスト（既存 E2E テストスイート）の実行
  - 既存プロジェクトでのセッション作成・削除テスト

**関連する機能要件**: REQ-004-004, REQ-004-011

**優先度**: 高（必須）

**検証方法**:
- [ ] 開発ツール設定を一切設定していない状態で、既存のセッション作成が成功することを確認
- [ ] GitHubPAT のみ設定されている既存プロジェクトで、Docker セッションが正常に起動することを確認
- [ ] 開発ツール設定機能追加前に作成されたプロジェクトが、引き続き動作することを確認
- [ ] 既存の Playwright E2E テストがすべてパスすることを確認

---

### NFR-COMP-002: GitHubPAT との共存

**EARS記法**: システムは既存の GitHubPAT 機能と開発ツール設定機能を独立して動作させなければならない

**測定基準**:
- 指標: 両機能の共存動作
- 目標値: GitHubPAT と SSH 鍵の両方が設定されている場合でも正常動作すること
- 測定方法:
  - 両方が設定されたプロジェクトでのリポジトリクローンテスト
  - Git の認証方式の自動選択動作確認

**関連する機能要件**: なし（アーキテクチャレベルの要件）

**優先度**: 高

**検証方法**:
- [ ] GitHubPAT と SSH 鍵の両方が設定されているプロジェクトで、HTTPS リポジトリが GitHubPAT で認証されることを確認
- [ ] GitHubPAT と SSH 鍵の両方が設定されているプロジェクトで、SSH リポジトリが SSH 鍵で認証されることを確認
- [ ] GitHubPAT のみ設定されているプロジェクトで、引き続き正常に動作することを確認
- [ ] SSH 鍵のみ設定されているプロジェクトで、SSH リポジトリにアクセスできることを確認

**技術的な共存ポイント**:
- GitHubPAT: HTTPS リポジトリ用（`https://github.com/...`）
- SSH 鍵: SSH リポジトリ用（`git@github.com:...`）
- Git は自動的に適切な認証方式を選択するため、両方が設定されていても競合しない

---

## 互換性維持のための推奨事項

### データベーススキーマの追加のみ

- 既存テーブル（Project, Session, GitHubPAT など）は変更しない
- 新しいテーブル（DeveloperSettings, SshKey）のみ追加
- 既存のマイグレーションファイルは変更しない

### API の非破壊的変更

- 既存 API エンドポイントは変更しない
- 新しいエンドポイント（`/api/developer-settings/*`, `/api/ssh-keys`）のみ追加
- 既存エンドポイントのレスポンス形式は維持

### 環境変数の追加のみ

- 既存の環境変数（`DATABASE_URL`, `CLAUDE_CODE_PATH` など）は変更しない
- 新しい環境変数（`ENCRYPTION_MASTER_KEY`）はオプション扱い（未設定でもエラーにしない）

### フロントエンドの段階的拡張

- 既存の設定画面（`/settings`）のレイアウトは維持
- 新しいメニュー項目（"Developer Tools"）を追加
- 既存ページのスタイルやコンポーネントと統一
