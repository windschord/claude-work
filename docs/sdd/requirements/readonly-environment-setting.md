# 要件定義書: プロジェクト実行環境の変更禁止

## 1. 概要

プロジェクト設定画面で実行環境（environment_id）をプロジェクト作成後に変更できないようにする。Git cloneとWorktreeの関係上、実行環境を途中で変更するとファイルの整合性が壊れる可能性があるため、読み取り専用表示に変更する。

## 2. ユーザーストーリー

### US-001: 実行環境の読み取り専用表示
プロジェクト管理者として、プロジェクトの実行環境が作成後に誤って変更されないようにしたい。
それにより、Git cloneとWorktreeの整合性が保たれる。

### US-002: 実行環境の自動判定結果の表示
プロジェクト管理者として、現在のプロジェクトがどの実行環境で動作するかを設定画面で確認したい。
それにより、セッション作成時にどの環境が使われるか事前に把握できる。

## 3. 機能要件

### REQ-001: 実行環境セレクトボックスの無効化
プロジェクト設定画面（/projects/[id]/settings）において、システムは実行環境の選択UIをセレクトボックスから読み取り専用テキスト表示に変更しなければならない。

**受入基準:**
- AC-001-1: プロジェクト設定ページで実行環境がテキスト表示される（セレクトボックスではない）
- AC-001-2: 保存ボタンとenvironment_id変更ロジックが削除されている

### REQ-002: プロジェクト設定モーダルの実行環境表示変更
プロジェクト設定モーダル（ProjectSettingsModal）において、システムは実行環境の選択UIをセレクトボックスから読み取り専用テキスト表示に変更しなければならない。

**受入基準:**
- AC-002-1: モーダル内の実行環境がテキスト表示される（セレクトボックスではない）
- AC-002-2: 保存処理からenvironment_idの送信が削除されている

### REQ-003: clone_locationに基づく自動判定結果の表示
システムは、プロジェクトのclone_locationに基づいて自動判定された実行環境情報を表示しなければならない。

**受入基準:**
- AC-003-1: clone_location='docker'のプロジェクトは「Docker」と表示される
- AC-003-2: clone_location='host'のプロジェクトは「Host」と表示される
- AC-003-3: environment_idが明示的に設定されている場合は、その環境名とタイプが表示される

### REQ-004: クローン場所継承メッセージの表示
システムは、実行環境がクローン場所から継承されている旨の説明メッセージを表示しなければならない。

**受入基準:**
- AC-004-1: 「クローン場所の設定に基づいて自動的に決定されます」等の説明が表示される
- AC-004-2: プロジェクト作成後に変更できない旨が明記されている

### REQ-005: PATCH APIからenvironment_id更新の削除
PATCH /api/projects/[project_id] APIにおいて、システムはenvironment_idの更新を受け付けてはならない。

**受入基準:**
- AC-005-1: PATCH APIがenvironment_idフィールドを無視する
- AC-005-2: 既存のenvironment_idの値は変更されない

## 4. 非機能要件

### NFR-001: 後方互換性
既存のプロジェクトのenvironment_id設定は保持され、セッション作成時の自動選択ロジックは変更しない。

### NFR-002: テスタビリティ
変更箇所に対して単体テストが存在すること。

## 5. 影響範囲

### 変更対象ファイル
- `src/components/settings/ProjectEnvironmentSettings.tsx` - 読み取り専用表示に変更
- `src/components/projects/ProjectSettingsModal.tsx` - 実行環境セレクトボックス削除
- `src/app/api/projects/[project_id]/route.ts` - PATCH APIからenvironment_id更新を削除

### 変更しないファイル
- `src/app/api/projects/[project_id]/sessions/route.ts` - セッション作成時の自動選択ロジックは維持
- `src/db/schema.ts` - DBスキーマは変更しない（environment_idカラムは残す）
