# タスク計画: ハイブリッド設計（ホスト環境/Docker環境でのプロジェクトclone）

## 概要

このドキュメントは、ハイブリッド設計の実装タスクを定義します。AIエージェント（Claude Code等）が実行可能な具体的なタスクに分解し、TDD（テスト駆動開発）に基づいて実装します。

## プロジェクトサマリ

- **目的**: プロジェクト登録時にリポジトリの保存場所（ホスト環境/Docker環境）を選択可能にする
- **対象ユーザー**: SSH Agent問題を抱える開発者、既存ユーザー
- **主要機能**: 保存場所選択UI、Docker環境でのclone、worktree作成
- **非機能要件**: 性能、セキュリティ、保守性

## 進捗サマリ

| フェーズ | タスク数 | 完了 | 進行中 | 未着手 | 進捗率 |
|---------|---------|------|--------|--------|--------|
| Phase 1 | 4 | 4 | 0 | 0 | 100% |
| Phase 2 | 5 | 5 | 0 | 0 | 100% |
| Phase 3 | 3 | 2 | 0 | 1 | 67% |
| Phase 4 | 4 | 4 | 0 | 0 | 100% |
| Phase 5 | 3 | 3 | 0 | 0 | 100% |
| **合計** | **19** | **18** | **0** | **1** | **95%** |

## フェーズ概要

### Phase 1: 基盤整備（推定: 1日）
データベーススキーマ変更、ConfigService実装、バリデーション機能の実装。

### Phase 2: Docker環境実装（推定: 2日）
DockerGitService実装、Dockerボリューム管理、認証情報マウント。

### Phase 3: worktree実装（推定: 1.5日）
HostGitServiceの確認、DockerGitServiceのworktree作成実装。

### Phase 4: UI実装（推定: 1日）
プロジェクト登録フォームの保存場所選択UI、設定画面の実装。

### Phase 5: テスト・統合（推定: 1.5日）
ユニットテスト、E2Eテスト、既存プロジェクトの互換性確認。

## タスク一覧

### Phase 1: 基盤整備

| ID | タスク名 | ステータス | 担当 | 推定工数 | 詳細 |
|----|---------|----------|------|----------|------|
| TASK-001 | データベーススキーマ変更 | DONE | - | 30分 | [詳細](phase-1/TASK-001.md) @phase-1/TASK-001.md |
| TASK-002 | ConfigService実装 | DONE | - | 40分 | [詳細](phase-1/TASK-002.md) @phase-1/TASK-002.md |
| TASK-003 | バリデーション関数実装 | DONE | - | 30分 | [詳細](phase-1/TASK-003.md) @phase-1/TASK-003.md |
| TASK-004 | GitOperationsインターフェース定義 | DONE | - | 20分 | [詳細](phase-1/TASK-004.md) @phase-1/TASK-004.md |

### Phase 2: Docker環境実装

| ID | タスク名 | ステータス | 担当 | 推定工数 | 詳細 |
|----|---------|----------|------|----------|------|
| TASK-005 | DockerGitService基本実装 | DONE | - | 60分 | [詳細](phase-2/TASK-005.md) @phase-2/TASK-005.md |
| TASK-006 | Dockerボリューム管理実装 | DONE | - | 40分 | [詳細](phase-2/TASK-006.md) @phase-2/TASK-006.md |
| TASK-007 | Docker環境でのgit clone実装 | DONE | - | 60分 | [詳細](phase-2/TASK-007.md) @phase-2/TASK-007.md |
| TASK-008 | 認証情報マウント実装（gh認証含む） | DONE | - | 40分 | [詳細](phase-2/TASK-008.md) @phase-2/TASK-008.md |
| TASK-009 | エラーハンドリングとクリーンアップ | DONE | - | 40分 | [詳細](phase-2/TASK-009.md) @phase-2/TASK-009.md |

### Phase 3: worktree実装

| ID | タスク名 | ステータス | 担当 | 推定工数 | 詳細 |
|----|---------|----------|------|----------|------|
| TASK-010 | HostGitServiceの確認と統合 | DONE | - | 30分 | [詳細](phase-3/TASK-010.md) @phase-3/TASK-010.md |
| TASK-011 | Docker環境でのworktree作成実装 | DONE | - | 60分 | [詳細](phase-3/TASK-011.md) @phase-3/TASK-011.md |
| TASK-012 | セッション起動時のマウント処理 | PARTIAL | - | 40分 | [詳細](phase-3/TASK-012.md) @phase-3/TASK-012.md |

### Phase 4: UI実装

| ID | タスク名 | ステータス | 担当 | 推定工数 | 詳細 |
|----|---------|----------|------|----------|------|
| TASK-013 | プロジェクト登録API変更 | DONE | - | 40分 | [詳細](phase-4/TASK-013.md) @phase-4/TASK-013.md |
| TASK-014 | プロジェクト登録フォームUI実装 | DONE | - | 60分 | [詳細](phase-4/TASK-014.md) @phase-4/TASK-014.md |
| TASK-015 | 設定画面実装（タイムアウト・デバッグモード） | DONE | - | 40分 | [詳細](phase-4/TASK-015.md) @phase-4/TASK-015.md |
| TASK-016 | プロジェクト一覧の環境バッジ表示 | DONE | - | 30分 | [詳細](phase-4/TASK-016.md) @phase-4/TASK-016.md |

### Phase 5: テスト・統合

| ID | タスク名 | ステータス | 担当 | 推定工数 | 詳細 |
|----|---------|----------|------|----------|------|
| TASK-017 | ユニットテスト作成 | DONE | - | 60分 | [詳細](phase-5/TASK-017.md) @phase-5/TASK-017.md |
| TASK-018 | E2Eテスト作成 | DONE | - | 60分 | [詳細](phase-5/TASK-018.md) @phase-5/TASK-018.md |
| TASK-019 | 既存プロジェクトの互換性確認 | DONE | - | 30分 | [詳細](phase-5/TASK-019.md) @phase-5/TASK-019.md |

## 並列実行可能なタスクグループ

エージェントチームで並列実行する場合、以下のグループを参考にしてください：

### グループ1（Phase 1並列実行可能）
- TASK-002（ConfigService）
- TASK-003（バリデーション）
- TASK-004（GitOperations interface）

※ TASK-001（スキーマ変更）は先に実行する必要がある

### グループ2（Phase 2並列実行可能）
- TASK-006（Dockerボリューム管理）
- TASK-008（認証情報マウント）

※ TASK-005（DockerGitService基本）は先に実行する必要がある

### グループ3（Phase 4並列実行可能）
- TASK-014（UI実装）
- TASK-015（設定画面）
- TASK-016（環境バッジ）

※ TASK-013（API変更）は先に実行する必要がある

## 依存関係マトリクス

| タスク | 依存するタスク |
|-------|---------------|
| TASK-002 | TASK-001 |
| TASK-003 | なし |
| TASK-004 | なし |
| TASK-005 | TASK-001, TASK-004 |
| TASK-006 | TASK-005 |
| TASK-007 | TASK-005, TASK-006 |
| TASK-008 | TASK-005 |
| TASK-009 | TASK-006, TASK-007 |
| TASK-010 | TASK-001, TASK-004 |
| TASK-011 | TASK-005, TASK-010 |
| TASK-012 | TASK-011 |
| TASK-013 | TASK-001, TASK-005, TASK-010 |
| TASK-014 | TASK-013 |
| TASK-015 | TASK-002 |
| TASK-016 | TASK-001 |
| TASK-017 | すべての実装タスク |
| TASK-018 | すべての実装タスク |
| TASK-019 | すべての実装タスク |

## TDD原則

すべてのタスクは以下のTDDサイクルに従います：

1. **テスト作成**: テストファイルを作成し、テストケースを記述
2. **テスト実行**: すべてのテストが失敗することを確認
3. **テストコミット**: テストのみをコミット
4. **実装**: テストを通過させる最小限の実装
5. **実装コミット**: すべてのテストが通過したらコミット
6. **リファクタリング**: 必要に応じてコードを改善

## 受入基準（全体）

すべてのタスクが完了し、以下の基準を満たした場合にプロジェクトは完了とみなされます：

- [ ] プロジェクト登録時に保存場所（ホスト/Docker）を選択できる
- [ ] Docker環境でのプロジェクトcloneが正常に動作する
- [ ] 両方の環境でセッション作成時にworktreeが正常に作成される
- [ ] gh CLI認証が正しくマウントされ、GitHub操作が可能
- [ ] タイムアウト設定が正しく動作し、設定で変更可能
- [ ] エラー時のDockerボリュームクリーンアップ設定が正しく動作する
- [ ] 既存プロジェクトが引き続き正常に動作する
- [ ] ユニットテストカバレッジが80%以上
- [ ] 全てのE2Eテストが通過する
- [ ] GitHub Actionsのテストが通過する

## リスク管理

| リスク | 対策タスク |
|-------|-----------|
| Docker環境でのパフォーマンス低下 | TASK-002（タイムアウト設定） |
| 既存プロジェクトの破壊 | TASK-019（互換性確認） |
| Dockerボリュームの孤立 | TASK-009（クリーンアップ） |
| SSH Agent問題の未解決 | TASK-008（認証マウント） |

## 変更履歴

| 日付 | バージョン | 変更内容 |
|-----|----------|---------|
| 2026-02-13 | 0.1 | 初版作成 |

## 関連ドキュメント

- [要件定義](../requirements/index.md) @../requirements/index.md
- [技術設計](../design/index.md) @../design/index.md
