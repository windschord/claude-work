# タスク

> このドキュメントはAIエージェント（Claude Code等）が実装を行うことを前提としています。
> タスクは具体的なファイルパス、技術仕様、検証可能な受入基準を含めて記載してください。

## 実装計画概要

### MVP範囲（フェーズ1〜4）

以下の機能をMVPとして実装:
- プロジェクト管理（CRUD）
- セッション作成と管理（単一セッション）
- Claude Codeとの対話（入出力、権限確認）
- 変更差分の確認（基本diff）
- Git操作（worktree作成/削除、rebase、squash merge）
- 認証（トークンベース）
- 基本的なレスポンシブ対応
- Docker Composeによるデプロイ

### 拡張機能（フェーズ5〜7）

MVP後に実装:
- セッションテンプレート（一括作成）
- プロンプト履歴
- ランスクリプト実行
- コミット履歴と復元
- リッチ出力（マークダウン/シンタックスハイライト）
- ターミナル統合（XTerm.js）
- サブエージェント出力の可視化
- モデル選択
- ライト/ダークモード

---

## フェーズ別タスク詳細

### [フェーズ1: 基盤構築](tasks/phase1.md)
*推定期間: 120分（AIエージェント作業時間）*
*MVP: Yes*

- タスク1.1: プロジェクト初期化
- タスク1.2: フロントエンド基本設定
- タスク1.3: API Routes基本設定
- タスク1.4: データベース設定

### [フェーズ2: バックエンドコア機能](tasks/phase2.md)
*推定期間: 240分（AIエージェント作業時間）*
*MVP: Yes*

- タスク2.1: 認証API実装
- タスク2.2: プロジェクトAPI実装
- タスク2.3: Git操作サービス実装
- タスク2.4: プロセスマネージャー実装
- タスク2.5: セッションAPI実装
- タスク2.6: Git操作API実装

### [フェーズ3: フロントエンドコア機能](tasks/phase3.md)
*推定期間: 210分（AIエージェント作業時間）*
*MVP: Yes*

- タスク3.1: 認証画面実装
- タスク3.2: レイアウトとナビゲーション実装
- タスク3.3: プロジェクト管理画面実装
- タスク3.4: セッション管理画面実装
- タスク3.5: セッション詳細画面実装
- タスク3.6: Diff表示画面実装
- タスク3.7: Git操作UI実装

### [フェーズ4: リアルタイム通信とMVP統合](tasks/phase4.md)
*推定期間: 185分（AIエージェント作業時間）*
*MVP: Yes*

- タスク4.1: WebSocketサーバー実装
- タスク4.2: WebSocketクライアント実装
- タスク4.3: リアルタイム更新統合
- タスク4.4: npxパッケージ設定
- タスク4.5: MVP E2Eテスト

### [フェーズ5: 拡張機能（セッション管理強化）](tasks/phase5.md)
*推定期間: 180分（AIエージェント作業時間）*
*MVP: No*

- タスク5.1: セッションテンプレート（一括作成）実装
- タスク5.2: プロンプト履歴実装
- タスク5.3: モデル選択実装
- タスク5.4: コミット履歴と復元実装
- タスク5.5: Git状態インジケーター実装
- タスク5.6: 詳細ステータスインジケーター実装

### [フェーズ6: 拡張機能（高度な機能）](tasks/phase6.md)
*推定期間: 240分（AIエージェント作業時間）*
*MVP: No*

- タスク6.1: ランスクリプト設定実装
- タスク6.2: ランスクリプト実行実装
- タスク6.3: ログフィルタリング/検索実装
- タスク6.4: リッチ出力実装
- タスク6.5: サブエージェント出力表示実装
- タスク6.6: ターミナル統合（バックエンド）実装
- タスク6.7: ターミナル統合（フロントエンド）実装

### [フェーズ7: UI/UX改善とドキュメント](tasks/phase7.md)
*推定期間: 85分（AIエージェント作業時間）*
*MVP: No*

- タスク7.1: ライト/ダークモード実装
- タスク7.2: モバイルUI最適化
- タスク7.3: ドキュメント作成

---

## タスクステータスの凡例

- `TODO` - 未着手
- `IN_PROGRESS` - 作業中
- `BLOCKED` - 依存関係や問題によりブロック中
- `REVIEW` - レビュー待ち
- `DONE` - 完了

## リスクと軽減策

### リスク1: Claude Code CLIの仕様変更

**影響度**: 高
**発生確率**: 中
**軽減策**:
- Claude Code出力パーサーを抽象化し、仕様変更に対応しやすくする
- バージョン固定と定期的な互換性確認

### リスク2: WebSocket接続の不安定性

**影響度**: 中
**発生確率**: 中
**軽減策**:
- 自動再接続機能の実装
- REST APIへのフォールバック機能

### リスク3: 並列セッションによるリソース枯渇

**影響度**: 高
**発生確率**: 低
**軽減策**:
- 最大セッション数の制限（10セッション）
- リソース監視とアラート

### リスク4: Gitコンフリクトの複雑化

**影響度**: 中
**発生確率**: 中
**軽減策**:
- コンフリクト発生時の明確な通知
- 手動解決を促すUI（ターミナル統合で対応可能）

## 備考

### 技術スタック

**フロントエンド**:
- Next.js 14 (App Router)
- TypeScript
- Tailwind CSS
- Zustand
- react-diff-viewer-continued
- XTerm.js（フェーズ6）
- Playwright（E2E）

**バックエンド（Next.js統合）**:
- Next.js 14 API Routes
- Next.jsカスタムサーバー（WebSocket統合）
- TypeScript
- Prisma 5.x
- better-sqlite3
- ws / socket.io（WebSocket）
- winston（ロギング）
- Vitest（テスト）

**インフラ**:
- Node.js 20+
- SQLite
- npxで実行可能（グローバルインストール不要）
- リバースプロキシ（Caddy/nginx推奨、本番環境のみ）

### コーディング規約

- TypeScript: strict mode有効
- ESLint + Prettier for linting/formatting
- コミットメッセージ: Conventional Commits
- ブランチ戦略: GitHub Flow
