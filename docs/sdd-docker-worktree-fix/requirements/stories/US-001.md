# US-001: Docker環境でのセッション作成と使用

## ユーザーストーリー

**As a** ClaudeWorkユーザー
**I want to** Docker環境でクローンされたプロジェクトでセッションを作成し、Shell/Diff/Commitsタブを使用したい
**So that** Docker環境のリポジトリでもHost環境と同様に開発作業ができる

## 背景

現在、Docker環境（`clone_location: docker`）でクローンされたプロジェクトのセッションを作成すると、worktreeパスの不整合によりPTYとgit操作が失敗する。

## 機能要件（EARS記法）

### セッション作成

- **REQ-001**: ユーザーがDocker環境プロジェクトで新規セッションを作成した時、システムはDockerボリューム内にworktreeを作成しなければならない
- **REQ-002**: セッション作成時、システムはworktreeパスをDocker環境用（`/repo/.worktrees/${sessionName}`）とホスト環境用（実際のDockerボリュームパス）の両方を管理しなければならない
- **REQ-003**: セッション作成完了時、システムはセッションステータスを`running`に更新しなければならない

### PTY初期化

- **REQ-004**: Docker環境セッションのPTY作成時、システムはDockerコンテナ内でPTYプロセスを起動しなければならない
- **REQ-005**: PTY起動時、システムはworking directoryを`/repo/.worktrees/${sessionName}`に設定しなければならない
- **REQ-006**: PTYプロセスが失敗した時、システムは適切なエラーメッセージを返し、無限ループに陥ってはならない

### Shell操作

- **REQ-007**: ユーザーがShellタブを開いた時、システムはDockerコンテナ内でシェルセッションを開始しなければならない
- **REQ-008**: Shellセッション中、システムはworktreeディレクトリ内でコマンドを実行しなければならない

### Git操作

- **REQ-009**: Diffタブを開いた時、システムはDockerコンテナ内で`git diff`コマンドを実行しなければならない
- **REQ-010**: Commitsタブを開いた時、システムはDockerコンテナ内で`git log`コマンドを実行しなければならない
- **REQ-011**: git操作がディレクトリ不在で失敗した時、システムはエラーを記録し、無限再試行してはならない

## 受入基準

- [ ] Docker環境プロジェクトで新規セッションを作成できる
- [ ] セッション作成後、Claudeタブが正常に動作する
- [ ] Shellタブでコマンドを実行できる
- [ ] Diffタブでgit diffを表示できる
- [ ] Commitsタブでコミット履歴を表示できる
- [ ] エラー発生時もサーバーがクラッシュしない
- [ ] 既存のHost環境セッションに影響がない

## 関連ストーリー

- US-002: Host環境との互換性維持

## 技術メモ

- DockerAdapterがworktreePathを `/repo/.worktrees/${sessionName}` として解釈
- PTY起動時はDockerコンテナ内でプロセスを起動
- git操作もDockerコンテナ内で実行
