# US-001: プロジェクト登録時の保存場所選択

## ユーザーストーリー

**As a** 開発者
**I want to** プロジェクト登録時にリポジトリの保存場所（ホスト環境/Docker環境）を選択できる
**So that** SSH認証問題を回避してプロジェクトを登録できる

## 背景・動機

現在、プロジェクト登録時にホスト環境でのgit cloneのみをサポートしているが、ホスト環境の1Password SSH Agentとの通信失敗により、プロジェクト登録が失敗するケースがある。Docker環境では既にSSH Agent転送が実装済みで正常動作しているため、ユーザーが保存場所を選択できるようにすることで、SSH認証問題を回避できる。

## 受入基準

### AC-001: 保存場所選択UIの表示
**Given** ユーザーがプロジェクト登録フォームを開いている時、
**When** フォームが表示される時、
**Then** システムは以下を表示しなければならない:
- 保存場所選択UI（Docker環境が複数ある場合を考慮）
- 各選択肢の説明テキスト
- デフォルト選択はDocker環境

### AC-002: ホスト環境の選択
**Given** ユーザーがプロジェクト登録フォームを開いている時、
**When** ユーザーがホスト環境を選択した時、
**Then** システムは以下の動作をしなければならない:
- cloneLocationフィールドに'host'を設定
- dockerVolumeIdフィールドはnull
- 環境IDは選択不要（ホスト環境固定）

### AC-003: Docker環境の選択
**Given** ユーザーがプロジェクト登録フォームを開いている時、
**When** ユーザーがDocker環境を選択した時、
**Then** システムは以下の動作をしなければならない:
- cloneLocationフィールドに'docker'を設定
- プロジェクトのデフォルト環境ID（environment_id）を使用
- dockerVolumeIdフィールドはDocker環境でのclone成功後に設定

### AC-004: 複数Docker環境がある場合
**Given** システムに複数のDocker環境が登録されている時、
**When** ユーザーがDocker環境を選択した時、
**Then** システムはプロジェクトのデフォルト環境IDを使用しなければならない

### AC-005: デフォルト値の設定
**Given** ユーザーがプロジェクト登録フォームを開いた時、
**When** フォームが初期表示される時、
**Then** システムはDocker環境をデフォルト選択しなければならない

## 機能要件

### REQ-001: 保存場所選択UI
システムはプロジェクト登録フォームに保存場所選択UIを表示しなければならない。

### REQ-002: ホスト環境選択時の動作
ユーザーがホスト環境を選択した時、システムはcloneLocation='host'を設定しなければならない。

### REQ-003: Docker環境選択時の動作
ユーザーがDocker環境を選択した時、システムはcloneLocation='docker'を設定し、プロジェクトのデフォルト環境IDを使用しなければならない。

### REQ-004: デフォルト選択
システムはプロジェクト登録フォーム初期表示時にDocker環境をデフォルト選択しなければならない。

### REQ-005: 説明テキストの表示
システムは各選択肢に以下の説明テキストを表示しなければならない:
- ホスト環境: 「ローカルマシンにリポジトリを保存します。SSH認証が必要です。」
- Docker環境: 「Dockerボリューム内にリポジトリを保存します。SSH Agent問題を回避できます。」

## 非機能要件

### NFR-001: ユーザビリティ
システムは保存場所選択UIを直感的でわかりやすく表示しなければならない。

### NFR-002: アクセシビリティ
システムは保存場所選択UIにアクセシビリティラベルを提供しなければならない。

## UI/UXノート

### UI形式
- Docker環境が複数ある場合を考慮したUI
- 各選択肢に説明テキストを表示
- ヘルプアイコンまたはツールチップで詳細説明を提供

### 推奨実装
- ラジオボタン形式（選択肢が2つのみの場合）
- セレクトボックス + ラジオボタン（Docker環境が複数の場合）

## 技術的ノート

### データベーススキーマ
- Projectテーブルに `cloneLocation` フィールドを追加
- 既存プロジェクトは自動的に 'host' として扱う

### API変更
- プロジェクト登録APIに `cloneLocation` パラメータを追加
- バリデーション: 'host' | 'docker' のみ許可

## 依存関係

### 依存するストーリー
なし（独立したストーリー）

### ブロックするストーリー
- US-002: ホスト環境でのプロジェクトclone
- US-003: Docker環境でのプロジェクトclone

## テストシナリオ

### シナリオ1: ホスト環境を選択してプロジェクトを登録
1. プロジェクト登録フォームを開く
2. ホスト環境を選択
3. リポジトリURLを入力
4. プロジェクト名を入力
5. 登録ボタンをクリック
6. 検証: cloneLocation='host' でプロジェクトが作成される

### シナリオ2: Docker環境を選択してプロジェクトを登録
1. プロジェクト登録フォームを開く
2. Docker環境が選択されていることを確認（デフォルト）
3. リポジトリURLを入力
4. プロジェクト名を入力
5. 登録ボタンをクリック
6. 検証: cloneLocation='docker' でプロジェクトが作成される

## 優先度の根拠

**優先度**: 高

保存場所選択UIは、他のすべてのストーリー（US-002, US-003）の基礎となる機能であり、最初に実装する必要がある。

## 見積もり

- **ストーリーポイント**: 3
- **実装時間**: 0.5日
- **テスト時間**: 0.5日
- **合計**: 1日

## ノート

### 設計上の決定事項
- デフォルトをDocker環境にすることで、新規ユーザーがSSH Agent問題に遭遇するリスクを低減
- 既存プロジェクトはすべてホスト環境として扱い、マイグレーション不要
- プロジェクトのデフォルト環境IDを使用することで、環境選択を簡素化

### 将来の拡張性
- 保存場所の事後変更機能（スコープ外）
- SSH環境のサポート（スコープ外）
