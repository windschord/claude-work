# 要件定義: リモートGitリポジトリ直接登録機能

## 概要

ClaudeWorkにおいて、リモートGitリポジトリ（GitHub、GitLab等）のURLを指定してプロジェクトを登録できる機能を提供する。現在のローカルパス指定によるプロジェクト登録機能に加え、リモートリポジトリを自動的にcloneしてプロジェクトとして登録できるようにする。

## ユーザーストーリー

### ストーリー1: リモートリポジトリからプロジェクトを登録する

**私は** ClaudeWorkユーザーとして
**〜したい** GitHubやGitLabなどのリモートリポジトリURLを指定してプロジェクトを登録
**なぜなら** ローカルに事前cloneする手間を省き、素早くプロジェクト作業を開始したい

#### 受入基準（EARS記法）

- **REQ-001**: ユーザーがプロジェクト追加モーダルで「リモート」タブを選択した時、システムはリモートリポジトリURL入力フォームを表示しなければならない
- **REQ-002**: ユーザーがリモートリポジトリURLを入力して登録ボタンをクリックした時、システムはリポジトリを指定ディレクトリにcloneしなければならない
- **REQ-003**: もしclone先ディレクトリが指定されていない場合、システムはデフォルトディレクトリ（data/repos/）にcloneしなければならない
- **REQ-004**: もしclone先ディレクトリがユーザーにより指定された場合、システムは指定されたディレクトリにcloneしなければならない
- **REQ-005**: clone処理中、システムは進捗状況（またはローディング表示）をユーザーに表示しなければならない
- **REQ-006**: clone完了後、システムはcloneしたリポジトリをプロジェクトとして自動的に登録しなければならない
- **REQ-007**: もしcloneに失敗した場合、システムはエラーメッセージを表示しなければならない

### ストーリー2: 登録済みリモートリポジトリを更新する

**私は** ClaudeWorkユーザーとして
**〜したい** リモートリポジトリからcloneしたプロジェクトを最新の状態に更新
**なぜなら** リモートの変更を取り込んで作業を継続したい

#### 受入基準（EARS記法）

- **REQ-008**: リモートからcloneしたプロジェクトの詳細画面において、システムは「更新」ボタンを表示しなければならない
- **REQ-009**: ユーザーが「更新」ボタンをクリックした時、システムはリモートリポジトリから最新の変更をfetch/pullしなければならない
- **REQ-010**: 更新処理中、システムはローディング表示をしなければならない
- **REQ-011**: 更新完了後、システムは成功メッセージを表示しなければならない
- **REQ-012**: もし更新に失敗した場合（競合等）、システムはエラーメッセージを表示しなければならない

### ストーリー3: セッション作成時に既存ブランチを選択する

**私は** ClaudeWorkユーザーとして
**〜したい** セッション作成時にリポジトリの既存ブランチを選択して作業を開始
**なぜなら** 特定のfeatureブランチやdevelopブランチから作業を始めたい

#### 受入基準（EARS記法）

- **REQ-013**: セッション作成フォームにおいて、システムはリポジトリの既存ブランチ一覧を表示しなければならない
- **REQ-014**: ユーザーが既存ブランチを選択した時、システムは選択されたブランチをベースにworktreeを作成しなければならない
- **REQ-015**: もしブランチが選択されていない場合、システムはデフォルトブランチ（main/master）をベースにworktreeを作成しなければならない

## 非機能要件

### 性能要件
- **NFR-001**: clone処理は大規模リポジトリ（1GB以上）でも正常に動作しなければならない（タイムアウトは設けない、または十分長い時間を設定）
- **NFR-002**: ブランチ一覧の取得は5秒以内に完了しなければならない

### セキュリティ要件
- **NFR-003**: システムはSSH認証を使用してプライベートリポジトリにアクセスできなければならない（システムのSSH設定を利用）
- **NFR-004**: clone先ディレクトリはパストラバーサル攻撃を防止するために検証されなければならない
- **NFR-005**: リモートURLはGit URLとして有効な形式であることを検証しなければならない

### ユーザビリティ要件
- **NFR-006**: プロジェクト追加モーダルは「ローカル」「リモート」タブで切り替え可能でなければならない
- **NFR-007**: リモートリポジトリからcloneしたプロジェクトは、一覧で視覚的に区別できなければならない

## 依存関係

- Git CLI（cloneコマンドの実行に必要）
- システムのSSH設定（プライベートリポジトリへのアクセス）
- 既存のプロジェクト登録機能（POST /api/projects）

## スコープ外

- Personal Access Token（PAT）による認証
- HTTPS認証でのユーザー名/パスワード入力
- Shallow clone（履歴を限定したclone）
- clone時のブランチ指定（デフォルトブランチのみclone）
- submoduleの自動初期化
- LFSファイルの自動取得
