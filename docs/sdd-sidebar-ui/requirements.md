# 要件定義書: サイドバーUI・Tree表示・左メニュー

## 概要

サイドバーのTree表示、セッション作成の簡略化、セッション一覧の統一、左メニューUI改善の要件を定義します。

## 関連ストーリー

- ストーリー20: セッション一覧のTree表示化
- ストーリー21: セッション作成の簡略化
- ストーリー23: セッション一覧ページの廃止とTree表示への統一
- ストーリー24: Tree表示のデフォルト展開
- ストーリー25: セッション詳細ページからのセッション削除
- ストーリー29: 左メニューUIの改善

---

## ストーリー20: セッション一覧のTree表示化

**私は** 開発者として
**〜したい** セッション一覧が左ペインのプロジェクト下にツリー形式で表示されること
**なぜなら** プロジェクトとセッションの関係が一目で分かり、素早くセッションに移動できるから

### 背景

- 現状、サイドバーにはプロジェクト一覧のみ表示されている
- セッション一覧はプロジェクト詳細ページのグリッドで表示されている
- ツリー表示でナビゲーション効率を向上させる

### 受入基準（EARS記法）

- **REQ-123**: サイドバーにプロジェクトが表示された時、システムはプロジェクト配下にセッション一覧をツリー形式で表示しなければならない
- **REQ-124**: プロジェクトノードがクリックされた時、システムはセッション一覧の展開/折りたたみを切り替えなければならない
- **REQ-125**: セッションノードがクリックされた時、システムはそのセッションの詳細ページに遷移しなければならない
- **REQ-126**: 現在表示中のセッションがある場合、システムはそのセッションノードをハイライト表示しなければならない
- **REQ-127**: セッションノードには、システムはセッション名とステータスアイコンを表示しなければならない
- **REQ-128**: プロジェクトページのセッション一覧（グリッド表示）は、システムは引き続き表示しなければならない

---

## ストーリー21: セッション作成の簡略化

**私は** 開発者として
**〜したい** ワンクリックでセッションを作成して開始できること
**なぜなら** 毎回プロンプトを入力するのは煩雑で、素早く作業を開始したいから

### 背景

- 現状、セッション作成にはプロンプト入力が必須
- セッション名は自動生成されるが、モデルは毎回選択が必要
- ワンクリック作成でワークフローを高速化する

### 受入基準（EARS記法）

- **REQ-129**: サイドバーのプロジェクト横に「+」ボタンが表示された時、システムはワンクリックでセッション作成を開始できなければならない
- **REQ-130**: セッションがワンクリック作成された時、システムは現状の自動生成ルール（タイムスタンプベース）でセッション名を設定しなければならない
- **REQ-131**: セッションがワンクリック作成された時、システムはグローバル設定のデフォルトモデルを使用しなければならない
- **REQ-132**: セッションがワンクリック作成された時、システムはプロンプトを空（なし）で作成しなければならない
- **REQ-133**: セッション詳細ページにおいて、システムはセッション名を編集できる機能を提供しなければならない
- **REQ-134**: システムはグローバル設定でデフォルトモデルを選択できる機能を提供しなければならない。デフォルトモデルの設定はローカルストレージ（キー: `claudework:default-model`）に保存される
- **REQ-135**: デフォルトモデルの選択UIは、システムはサイドバーのセッション作成ボタン（+ボタン）の近く、またはセッション作成時に表示されるドロップダウン/モーダル内に配置しなければならない
- **REQ-136**: 既存のセッション作成フォーム（プロンプト入力あり）は、システムは引き続き利用可能としなければならない

---

## ストーリー23: セッション一覧ページの廃止とTree表示への統一

**私は** 開発者として
**〜したい** セッション一覧ページを廃止し、左ペインのTree表示からセッションを選択するUIに統一したい
**なぜなら** 複数の画面を行き来する必要がなく、ナビゲーションが効率的になるから

### 背景

- 現状、/sessions/ページが存在するがTree表示と機能が重複している
- Tree表示でセッション選択できれば、専用の一覧ページは不要
- UIを統一することでユーザー体験が向上する

### 受入基準（EARS記法）

- **REQ-142**: ユーザーが/sessions/パスにアクセスした時、システムはプロジェクト一覧ページにリダイレクトしなければならない
- **REQ-143**: ナビゲーションメニューから「Sessions」リンクは削除されなければならない
- **REQ-144**: 左ペインのプロジェクトTree表示において、システムはプロジェクト配下のセッションを常にTree内に存在させなければならない（展開/折りたたみはREQ-124に従う）
- **REQ-145**: Tree表示のセッションノードをクリックした時、システムはセッション詳細ページに直接遷移しなければならない

---

## ストーリー24: Tree表示のデフォルト展開

**私は** 開発者として
**〜したい** 左ペインのプロジェクトTree配下のセッション一覧が初期状態で展開されていること
**なぜなら** 毎回プロジェクトをクリックして展開する手間を省きたいから

### 背景

- 現状、Tree表示はデフォルトで折りたたまれている
- セッションへのアクセスには毎回クリックが必要
- デフォルト展開でワンアクション減らす

### 受入基準（EARS記法）

- **REQ-146**: ページ読み込み時、システムはすべてのプロジェクトノードを展開した状態で表示しなければならない
- **REQ-147**: ユーザーがプロジェクトノードをクリックして折りたたんだ時、システムはその状態をローカルストレージに保存しなければならない
- **REQ-148**: ページを再読み込みした時、システムは保存された展開/折りたたみ状態を復元しなければならない
- **REQ-149**: 新しいプロジェクトが追加された時、システムはそのプロジェクトを展開した状態で表示しなければならない

---

## ストーリー25: セッション詳細ページからのセッション削除

**私は** 開発者として
**〜したい** セッション詳細ページからセッションを削除できること
**なぜなら** 不要なセッションを素早く削除したいから

### 背景

- 現状、セッション削除はプロジェクト詳細ページのセッション一覧からのみ可能
- セッション詳細ページで作業中に削除したい場合、画面遷移が必要
- セッション詳細ページに削除ボタンを追加することで効率化

### 受入基準（EARS記法）

- **REQ-150**: セッション詳細ページにおいて、システムはセッション削除ボタンを表示しなければならない
- **REQ-151**: ユーザーが削除ボタンをクリックした時、システムは確認ダイアログを表示しなければならない
- **REQ-152**: 確認ダイアログには、システムは削除されるセッション名とworktreeパスを表示しなければならない
- **REQ-153**: ユーザーが削除を確認した時、システムはセッションとworktreeを削除しなければならない
- **REQ-154**: 削除が完了した時、システムはプロジェクト一覧ページ（`/`）にリダイレクトしなければならない
- **REQ-155**: 削除中にエラーが発生した場合、システムはエラーメッセージをトースト通知で表示しなければならない

---

## ストーリー29: 左メニューUIの改善

**私は** 開発者として
**〜したい** 左メニューからリポジトリとセッションを効率的に管理
**なぜなら** 画面遷移なしでプロジェクトとセッションの操作を行いたいから

### 背景

- 現状、リポジトリの追加はダッシュボードから行う必要がある
- リポジトリの設定変更はプロジェクト詳細ページでのみ可能
- セッションの削除もセッション詳細ページに遷移が必要
- PRのステータスがTree表示で確認できない

### 受入基準（EARS記法）

#### リポジトリの追加削除

- **REQ-178**: サイドバーにおいて、システムは「リポジトリを追加」ボタンを表示しなければならない
- **REQ-179**: ユーザーが「リポジトリを追加」ボタンをクリックした時、システムはリポジトリ追加モーダルを表示しなければならない
- **REQ-180**: リポジトリ追加モーダルにおいて、システムはリポジトリ名とパスの入力フィールドを提供しなければならない
- **REQ-181**: リポジトリが正常に追加された時、システムはサイドバーのプロジェクト一覧を即座に更新しなければならない
- **REQ-182**: プロジェクトノードにおいて、システムは右クリックでコンテキストメニューを表示しなければならない
- **REQ-183**: プロジェクトのコンテキストメニューにおいて、システムは「削除」オプションを提供しなければならない
- **REQ-184**: ユーザーがプロジェクト削除を選択した時、システムは確認ダイアログを表示しなければならない
- **REQ-185**: プロジェクト削除確認ダイアログにおいて、システムは「worktreeは削除されません」という注意書きを表示しなければならない

#### リポジトリの設定変更

- **REQ-186**: プロジェクトのコンテキストメニューにおいて、システムは「設定」オプションを提供しなければならない
- **REQ-187**: ユーザーがプロジェクト設定を選択した時、システムはプロジェクト設定モーダルを表示しなければならない
- **REQ-188**: プロジェクト設定モーダルにおいて、システムは以下の項目を編集可能にしなければならない:
  - プロジェクト名
  - リポジトリパス
  - ランスクリプトの追加・編集・削除
- **REQ-189**: プロジェクト設定が保存された時、システムはサイドバーの表示を即座に更新しなければならない

#### セッションの削除

- **REQ-190**: セッションノードにホバーした時、システムは削除アイコン（ゴミ箱）を表示しなければならない
- **REQ-191**: ユーザーが削除アイコンをクリックした時、システムは確認ダイアログを表示しなければならない
- **REQ-192**: セッション削除確認ダイアログにおいて、システムはセッション名とworktreeパスを表示しなければならない
- **REQ-193**: セッションが削除された時、システムはサイドバーのセッション一覧を即座に更新しなければならない
- **REQ-194**: 削除されたセッションの詳細ページを表示中だった場合、システムはプロジェクト一覧ページにリダイレクトしなければならない

#### セッションのPR番号表示

- **REQ-195**: セッションにPRが関連付けられている場合、セッションノードにおいてシステムはPR番号を表示しなければならない
- **REQ-196**: PR番号表示において、システムはPRのステータスを色とテキストで示さなければならない（open=緑+"Open"、merged=紫+"Merged"、closed=赤+"Closed"）。色覚多様性に配慮し、色以外の識別手段（テキストまたはアイコン）を必ず併記する
- **REQ-197**: ユーザーがPR番号をクリックした時、システムは新しいタブでGitHubのPRページを開かなければならない

**注意**: ストーリー29は左メニューの複数機能（リポジトリ管理、セッション管理、PR表示、環境表示）をまとめて定義しています。実装時は機能ごとに分割することを検討してください。

#### セッションの動作環境表示

- **REQ-198**: セッションノードにおいて、システムはセッションの動作環境タイプ（HOST/DOCKER/SSH）をバッジで表示しなければならない
- **REQ-199**: 動作環境バッジにおいて、システムは環境タイプに応じた色を表示しなければならない（HOST=緑、DOCKER=青、SSH=紫）
- **REQ-200**: 動作環境バッジにホバーした時、システムは環境名をツールチップで表示しなければならない

---

## 非機能要件

### パフォーマンス

- **NFR-020**: ツリー表示の展開/折りたたみは100ms以内に完了しなければならない
- **NFR-025**: Tree表示のセッション一覧取得は500ms以内に完了しなければならない
- **NFR-026**: セッション削除確認ダイアログは100ms以内に表示されなければならない
- **NFR-033**: サイドバーのコンテキストメニューは100ms以内に表示されなければならない
- **NFR-034**: プロジェクト・セッション操作後のサイドバー更新は500ms以内に完了しなければならない

### ユーザビリティ

- **NFR-022**: ツリー表示はキーボードナビゲーションをサポートしなければならない
- **NFR-028**: Tree表示の展開/折りたたみ状態はセッション間で永続化されなければならない
- **NFR-029**: 削除確認ダイアログはキーボードでEscキーを押すことでキャンセルできなければならない
