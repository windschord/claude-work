# 要件定義: 薄いラッパーUI

## 概要

現在のClaudeWorkはClaude Codeの出力を解析して独自のUI要素（Markdownレンダリング、コードブロック、権限確認ダイアログ等）として表示している。これをターミナルベースの薄いラッパーに変更し、ユーザーがWeb上からClaude Codeのターミナルをそのまま使えるようにする。

## ユーザーストーリー

### ストーリー1: ターミナルでClaude Codeを直接操作

**私は** 開発者として
**〜したい** Web上でClaude Codeのターミナルを直接操作
**なぜなら** Claude Codeの全機能（対話モード、エスケープシーケンス、色表示等）をそのまま利用できるから

#### 受入基準（EARS記法）

- REQ-201: セッション詳細ページを開いた時、システムはClaude CodeターミナルをXTerm.jsで表示しなければならない
- REQ-202: ユーザーがターミナルにテキストを入力した時、システムはその入力をClaude Codeプロセスに送信しなければならない
- REQ-203: Claude Codeがテキストを出力した時、システムはその出力をターミナルにそのまま表示しなければならない
- REQ-204: Claude Codeが権限確認を要求した時、システムはターミナル内でそのまま表示し、ユーザーがy/nで応答できるようにしなければならない
- REQ-205: Claude Codeがエスケープシーケンス（色、カーソル移動等）を出力した時、システムはそれを正しく解釈して表示しなければならない

### ストーリー2: シェルターミナルとの切り替え

**私は** 開発者として
**〜したい** Claude Codeターミナルとシェルターミナルを切り替えて使用
**なぜなら** Claude Codeの作業中にgitコマンドやその他のシェル操作も必要になるから

#### 受入基準（EARS記法）

- REQ-206: セッション詳細ページにおいて、システムは「Claude」タブと「Shell」タブを表示しなければならない
- REQ-207: ユーザーが「Shell」タブをクリックした時、システムはworktree内のシェルターミナルを表示しなければならない
- REQ-208: タブを切り替えた時、システムは各ターミナルの状態（履歴、接続）を維持しなければならない

### ストーリー3: セッション管理

**私は** 開発者として
**〜したい** セッションの開始・停止・再起動を簡単に行いたい
**なぜなら** Claude Codeの状態を管理する必要があるから

#### 受入基準（EARS記法）

- REQ-209: セッション作成時、システムはworktreeを作成し、Claude Codeプロセスを起動しなければならない
- REQ-210: ユーザーが「停止」ボタンをクリックした時、システムはClaude Codeプロセスを終了しなければならない
- REQ-211: ユーザーが「再起動」ボタンをクリックした時、システムはClaude Codeプロセスを再起動しなければならない
- REQ-212: セッション削除時、システムはClaude Codeプロセスを終了し、worktreeを削除しなければならない

### ストーリー4: 補助機能

**私は** 開発者として
**〜したい** Diff表示、コミット履歴、スクリプト実行の機能を引き続き使用
**なぜなら** これらはClaude Codeターミナルとは独立した便利な機能だから

#### 受入基準（EARS記法）

- REQ-213: システムは「Diff」「Commits」「Scripts」タブを引き続き提供しなければならない
- REQ-214: 各補助機能タブの動作は現在の実装を維持しなければならない

## 非機能要件

- NFR-201: ターミナルの入力遅延は50ms以下でなければならない
- NFR-202: ターミナルのリサイズはウィンドウサイズ変更に追従しなければならない
- NFR-203: WebSocket切断時、システムは自動再接続を試みなければならない

## 削除される機能

以下の機能は本リデザインで削除される：

| 機能 | 理由 |
|------|------|
| MessageBubble表示 | ターミナル表示に統合 |
| Markdownレンダリング | ターミナルがそのまま表示 |
| コードブロック表示 | ターミナルがそのまま表示 |
| 権限確認ダイアログ | ターミナル内でy/n応答 |
| メッセージ入力欄 | ターミナルに直接入力 |
| SubAgent折り畳み表示 | ターミナルがそのまま表示 |
| stream-json出力パース | 不要（--printフラグ不使用） |

## 用語定義

| 用語 | 定義 |
|------|------|
| Claude Codeターミナル | Claude Codeプロセスを直接操作するXTerm.jsターミナル |
| シェルターミナル | worktree内でシェルコマンドを実行するXTerm.jsターミナル |
| 薄いラッパー | Claude Codeの出力を加工せずそのまま表示するUI |
