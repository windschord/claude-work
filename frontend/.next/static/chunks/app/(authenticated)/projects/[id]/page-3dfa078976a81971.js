(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[459],{4196:function(e,s,t){Promise.resolve().then(t.bind(t,3508))},3508:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return j}});var r=t(7821),a=t(8078),n=t(8504),o=t(4822),l=t(4553),i=t(4790);let d=(0,l.U)(e=>({sessions:[],isLoading:!1,error:null,fetchSessions:async s=>{e({isLoading:!0,error:null});try{let t=await i.h.getSessions(s);e({sessions:t,isLoading:!1})}catch(s){e({isLoading:!1,error:s instanceof Error?s.message:"セッション一覧の取得に失敗しました"})}},createSession:async(s,t,r,a,n)=>{e({isLoading:!0,error:null});try{let o=await i.h.createSession(s,t,r,a,n);return e(e=>({sessions:[...e.sessions,...o],isLoading:!1})),o}catch(s){throw e({isLoading:!1,error:s instanceof Error?s.message:"セッションの作成に失敗しました"}),s}},stopSession:async s=>{e({isLoading:!0,error:null});try{await i.h.stopSession(s),e(e=>({sessions:e.sessions.map(e=>e.id===s?{...e,status:"completed"}:e),isLoading:!1}))}catch(s){throw e({isLoading:!1,error:s instanceof Error?s.message:"セッションの停止に失敗しました"}),s}},deleteSession:async s=>{e({isLoading:!0,error:null});try{await i.h.deleteSession(s),e(e=>({sessions:e.sessions.filter(e=>e.id!==s),isLoading:!1}))}catch(s){throw e({isLoading:!1,error:s instanceof Error?s.message:"セッションの削除に失敗しました"}),s}},clearError:()=>e({error:null})}));var c=t(9632);function m(e){let{hasUncommittedChanges:s,changedFilesCount:t}=e;return s?(0,r.jsxs)("div",{className:"flex items-center gap-1 text-yellow-600",title:"".concat(t,"個のファイルに変更あり"),children:[(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),(0,r.jsxs)("span",{className:"text-xs",children:[t,"個変更"]})]}):(0,r.jsxs)("div",{className:"flex items-center gap-1 text-green-600",title:"クリーン",children:[(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),(0,r.jsx)("span",{className:"text-xs",children:"クリーン"})]})}function x(e){let{sessions:s,isLoading:t}=e,a=(0,n.useRouter)();return t?(0,r.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,r.jsx)("p",{className:"text-gray-500",children:"読み込み中..."})}):0===s.length?(0,r.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,r.jsx)("p",{className:"text-gray-500",children:"セッションがありません"})}):(0,r.jsx)("div",{className:"space-y-3 md:space-y-2",children:s.map(e=>(0,r.jsx)("div",{onClick:()=>a.push("/sessions/".concat(e.id)),className:"bg-white border border-gray-200 rounded-lg p-4 md:p-4 hover:shadow-md transition-shadow cursor-pointer active:bg-gray-50",children:(0,r.jsxs)("div",{className:"flex items-start justify-between",children:[(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("h3",{className:"text-base md:text-sm font-semibold text-gray-900 truncate",children:e.name}),(0,r.jsxs)("p",{className:"text-sm md:text-xs text-gray-500 mt-2 md:mt-1",children:["ブランチ: ",e.branch_name]}),(0,r.jsxs)("p",{className:"text-sm md:text-xs text-gray-400 mt-1 md:mt-0.5",children:["作成日時: ",new Date(e.created_at).toLocaleString("ja-JP")]})]}),(0,r.jsxs)("div",{className:"ml-4 flex-shrink-0 flex flex-col items-end gap-2",children:[(0,r.jsx)(c.Z,{status:e.status}),(0,r.jsx)(m,{hasUncommittedChanges:e.has_uncommitted_changes,changedFilesCount:e.changed_files_count})]})]})},e.id))})}var u=t(746);let h=(0,l.U)(e=>({history:[],isLoading:!1,error:null,fetchHistory:async s=>{e({isLoading:!0,error:null});try{let t=await i.h.getPromptHistory(s);e({history:t,isLoading:!1})}catch(s){e({isLoading:!1,error:s instanceof Error?s.message:"プロンプト履歴の取得に失敗しました"})}},saveToHistory:async(s,t)=>{e({error:null});try{let r=await i.h.savePromptHistory(s,t);e(e=>({history:[r,...e.history].slice(0,20)}))}catch(s){throw e({error:s instanceof Error?s.message:"プロンプト履歴の保存に失敗しました"}),s}},deleteFromHistory:async(s,t)=>{e({error:null});try{await i.h.deletePromptHistory(s,t),e(e=>({history:e.history.filter(e=>e.id!==t)}))}catch(s){throw e({error:s instanceof Error?s.message:"プロンプト履歴の削除に失敗しました"}),s}},clearError:()=>e({error:null})}));function g(e){let{projectId:s,onSelect:t}=e,[n,o]=(0,a.useState)(!1),l=(0,a.useRef)(null),{history:i,isLoading:d,fetchHistory:c,deleteFromHistory:m}=h();(0,a.useEffect)(()=>{s&&c(s)},[s,c]),(0,a.useEffect)(()=>{let e=e=>{l.current&&!l.current.contains(e.target)&&o(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]);let x=e=>{t(e),o(!1)},u=async(e,t)=>{e.stopPropagation();try{await m(s,t)}catch(e){console.error("Failed to delete prompt history:",e)}};return 0===i.length?null:(0,r.jsxs)("div",{className:"relative",ref:l,children:[(0,r.jsx)("button",{type:"button",onClick:()=>o(!n),className:"px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",title:"プロンプト履歴",children:(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}),n&&(0,r.jsx)("div",{className:"absolute right-0 mt-2 w-96 bg-white rounded-md shadow-lg z-10 border border-gray-200",children:(0,r.jsxs)("div",{className:"py-1 max-h-96 overflow-y-auto",children:[(0,r.jsx)("div",{className:"px-4 py-2 text-xs font-semibold text-gray-700 bg-gray-50 border-b border-gray-200",children:"プロンプト履歴"}),d?(0,r.jsx)("div",{className:"px-4 py-3 text-sm text-gray-500 text-center",children:"読み込み中..."}):0===i.length?(0,r.jsx)("div",{className:"px-4 py-3 text-sm text-gray-500 text-center",children:"履歴がありません"}):i.map(e=>(0,r.jsx)("div",{className:"px-4 py-2 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0 group",onClick:()=>x(e.prompt_text),children:(0,r.jsxs)("div",{className:"flex items-start justify-between",children:[(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("p",{className:"text-sm text-gray-900 truncate",children:[e.prompt_text.substring(0,60),e.prompt_text.length>60?"...":""]}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:new Date(e.created_at).toLocaleString("ja-JP")})]}),(0,r.jsx)("button",{onClick:s=>u(s,e.id),className:"ml-2 p-1 text-gray-400 hover:text-red-600 opacity-0 group-hover:opacity-100 transition-opacity",title:"削除",children:(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})},e.id))]})})]})}let b=[{value:"claude-sonnet-4-20250514",label:"Claude Sonnet 4"},{value:"claude-opus-4-20250514",label:"Claude Opus 4"},{value:"claude-3-5-haiku-20241022",label:"Claude 3.5 Haiku"}];function p(e){let{projectId:s,project:t,onSubmit:n,isLoading:o}=e,[l,i]=(0,a.useState)(!1),{register:d,handleSubmit:c,formState:{errors:m},reset:x,watch:p,setValue:y}=(0,u.cI)({defaultValues:{name:"",initialPrompt:"",count:1,model:t.default_model}}),{saveToHistory:f}=h(),j=p("count"),v=p("name"),N=async e=>{try{if(await n(e.name,e.initialPrompt||void 0,e.count,e.model),e.initialPrompt&&e.initialPrompt.trim())try{await f(s,e.initialPrompt.trim())}catch(e){console.error("Failed to save prompt history:",e)}x(),i(!1)}catch(e){}};return(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow p-4 md:p-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsx)("h2",{className:"text-base md:text-lg font-semibold text-gray-900",children:"新しいセッション"}),!l&&(0,r.jsx)("button",{type:"button",onClick:()=>i(!0),className:"min-h-[44px] px-4 md:px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 active:bg-blue-800",children:"作成"})]}),l&&(0,r.jsxs)("form",{onSubmit:c(N),className:"space-y-4 md:space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{htmlFor:"name",className:"block text-sm md:text-sm font-medium text-gray-700 mb-1",children:["セッション名 ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("input",{type:"text",id:"name",...d("name",{required:"セッション名は必須です",minLength:{value:1,message:"セッション名を入力してください"}}),className:"w-full min-h-[44px] px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-base md:text-sm",placeholder:"例: feature-implementation",disabled:o}),m.name&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-600",children:m.name.message})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"count",className:"block text-sm md:text-sm font-medium text-gray-700 mb-1",children:"セッション数"}),(0,r.jsx)("select",{id:"count",...d("count",{valueAsNumber:!0,min:{value:1,message:"セッション数は1以上である必要があります"},max:{value:10,message:"セッション数は10以下である必要があります"}}),className:"w-full min-h-[44px] px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-base md:text-sm",disabled:o,children:Array.from({length:10},(e,s)=>s+1).map(e=>(0,r.jsx)("option",{value:e,children:e},e))}),m.count&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-600",children:m.count.message})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"model",className:"block text-sm md:text-sm font-medium text-gray-700 mb-1",children:"モデル"}),(0,r.jsx)("select",{id:"model",...d("model"),className:"w-full min-h-[44px] px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-base md:text-sm",disabled:o,children:b.map(e=>(0,r.jsx)("option",{value:e.value,children:e.label},e.value))})]}),j>1&&v&&(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"作成されるセッション名（プレビュー）"}),(0,r.jsx)("div",{className:"text-sm text-gray-600 bg-gray-50 p-3 rounded-md border border-gray-200",children:(!v||j<=1?[v||""]:Array.from({length:Math.min(j,10)},(e,s)=>"".concat(v,"-").concat(s+1))).join(", ")})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,r.jsx)("label",{htmlFor:"initialPrompt",className:"block text-sm md:text-sm font-medium text-gray-700",children:"初期プロンプト（任意）"}),(0,r.jsx)(g,{projectId:s,onSelect:e=>{y("initialPrompt",e)}})]}),(0,r.jsx)("textarea",{id:"initialPrompt",...d("initialPrompt"),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-base md:text-sm",placeholder:"Claude Codeに最初に送信するプロンプトを入力してください",disabled:o})]}),(0,r.jsxs)("div",{className:"flex flex-col md:flex-row gap-3",children:[(0,r.jsx)("button",{type:"submit",disabled:o,className:"flex-1 min-h-[44px] px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed active:bg-blue-800",children:o?"作成中...":"作成"}),(0,r.jsx)("button",{type:"button",onClick:()=>{x(),i(!1)},disabled:o,className:"min-h-[44px] px-4 py-2 bg-gray-200 text-gray-700 text-sm font-medium rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 disabled:opacity-50 disabled:cursor-not-allowed active:bg-gray-400",children:"キャンセル"})]})]})]})}var y=t(4549);function f(e){let{projectId:s}=e,{runScripts:t,loading:n,error:o,fetchRunScripts:l,createRunScript:i,updateRunScript:d,deleteRunScript:c,clearError:m}=(0,y.Y)(),[x,u]=(0,a.useState)(!1),[h,g]=(0,a.useState)(null),[b,p]=(0,a.useState)({name:"",command:""}),f=t[s]||[];(0,a.useEffect)(()=>{l(s)},[s,l]);let j=async e=>{e.preventDefault();try{null!==h?(await d(s,h,b.name,b.command),g(null)):(await i(s,b.name,b.command),u(!1)),p({name:"",command:""})}catch(e){}},v=e=>{g(e.id),p({name:e.name,command:e.command}),u(!1)},N=async e=>{if(confirm("このランスクリプトを削除してもよろしいですか?"))try{await c(s,e)}catch(e){}};return(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"ランスクリプト設定"}),!x&&null===h&&(0,r.jsx)("button",{onClick:()=>u(!0),className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"追加"})]}),o&&(0,r.jsxs)("div",{className:"p-4 bg-red-100 border border-red-400 text-red-700 rounded",children:[o,(0,r.jsx)("button",{onClick:m,className:"ml-4 underline",children:"閉じる"})]}),(x||null!==h)&&(0,r.jsxs)("form",{onSubmit:j,className:"p-4 border border-gray-300 rounded space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-1",children:"名前"}),(0,r.jsx)("input",{type:"text",id:"name",value:b.name,onChange:e=>p({...b,name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,placeholder:"例: Build"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"command",className:"block text-sm font-medium text-gray-700 mb-1",children:"コマンド"}),(0,r.jsx)("input",{type:"text",id:"command",value:b.command,onChange:e=>p({...b,command:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono text-sm",required:!0,placeholder:"例: npm run build"})]}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)("button",{type:"submit",disabled:n,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:bg-gray-400 transition-colors",children:n?"保存中...":null!==h?"更新":"追加"}),(0,r.jsx)("button",{type:"button",onClick:()=>{u(!1),g(null),p({name:"",command:""}),m()},className:"px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400 transition-colors",children:"キャンセル"})]})]}),n&&0===f.length?(0,r.jsx)("div",{className:"text-center py-8 text-gray-500",children:"読み込み中..."}):0===f.length?(0,r.jsx)("div",{className:"text-center py-8 text-gray-500",children:"ランスクリプトがありません"}):(0,r.jsx)("div",{className:"space-y-2",children:f.map(e=>(0,r.jsx)("div",{className:"p-4 border border-gray-300 rounded hover:bg-gray-50 transition-colors",children:(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h3",{className:"font-medium text-gray-900",children:e.name}),(0,r.jsx)("p",{className:"text-sm text-gray-600 font-mono mt-1",children:e.command})]}),h!==e.id&&(0,r.jsxs)("div",{className:"flex space-x-2 ml-4",children:[(0,r.jsx)("button",{onClick:()=>v(e),className:"px-3 py-1 text-sm bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition-colors",children:"編集"}),(0,r.jsx)("button",{onClick:()=>N(e.id),className:"px-3 py-1 text-sm bg-red-100 text-red-700 rounded hover:bg-red-200 transition-colors",children:"削除"})]})]})},e.id))})]})}function j(){let e=(0,n.useParams)().id,[s,t]=(0,a.useState)("sessions"),{projects:l,fetchProjects:i,isLoading:c}=(0,o.c)(),{sessions:m,fetchSessions:u,createSession:h,isLoading:g,error:b}=d();(0,a.useEffect)(()=>{0===l.length&&i()},[l.length,i]),(0,a.useEffect)(()=>{e&&u(e)},[e,u]);let y=l.find(s=>s.id===e),j=async(s,t,r,a)=>{await h(e,s,t,r,a)};return c?(0,r.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,r.jsx)("p",{className:"text-gray-500",children:"読み込み中..."})}):y?(0,r.jsxs)("div",{className:"h-full p-4 md:p-6",children:[(0,r.jsxs)("div",{className:"mb-4 md:mb-6",children:[(0,r.jsx)("h1",{className:"text-xl md:text-2xl font-bold text-gray-900",children:y.name}),(0,r.jsx)("p",{className:"text-sm md:text-sm text-gray-500 mt-1 truncate",children:y.path})]}),b&&(0,r.jsx)("div",{className:"mb-4 bg-red-50 border border-red-200 rounded-md p-3 md:p-4",children:(0,r.jsx)("p",{className:"text-sm text-red-800",children:b})}),(0,r.jsx)("div",{className:"mb-4 md:mb-6 border-b border-gray-200",children:(0,r.jsxs)("nav",{className:"-mb-px flex space-x-6 md:space-x-8",children:[(0,r.jsx)("button",{onClick:()=>t("sessions"),className:"".concat("sessions"===s?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"," min-h-[44px] whitespace-nowrap py-3 md:py-4 px-1 border-b-2 font-medium text-sm transition-colors active:text-blue-700"),children:"セッション"}),(0,r.jsx)("button",{onClick:()=>t("settings"),className:"".concat("settings"===s?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"," min-h-[44px] whitespace-nowrap py-3 md:py-4 px-1 border-b-2 font-medium text-sm transition-colors active:text-blue-700"),children:"設定"})]})}),"sessions"===s&&(0,r.jsxs)("div",{className:"space-y-4 md:space-y-6",children:[(0,r.jsx)(p,{projectId:e,project:y,onSubmit:j,isLoading:g}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow p-4 md:p-6",children:[(0,r.jsx)("h2",{className:"text-base md:text-lg font-semibold text-gray-900 mb-3 md:mb-4",children:"セッション一覧"}),(0,r.jsx)(x,{sessions:m,isLoading:g})]})]}),"settings"===s&&(0,r.jsx)("div",{className:"bg-white rounded-lg shadow p-4 md:p-6",children:(0,r.jsx)(f,{projectId:e})})]}):(0,r.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,r.jsx)("p",{className:"text-gray-500",children:"プロジェクトが見つかりません"})})}},4822:function(e,s,t){"use strict";t.d(s,{c:function(){return n}});var r=t(4553),a=t(4790);let n=(0,r.U)(e=>({projects:[],isLoading:!1,error:null,selectedProjectId:null,fetchProjects:async()=>{e({isLoading:!0,error:null});try{let s=await a.h.getProjects();e({projects:s,isLoading:!1})}catch(s){e({isLoading:!1,error:s instanceof Error?s.message:"プロジェクト一覧の取得に失敗しました"})}},addProject:async s=>{e({isLoading:!0,error:null});try{let t=await a.h.createProject(s);e(e=>({projects:[...e.projects,t],isLoading:!1}))}catch(s){throw e({isLoading:!1,error:s instanceof Error?s.message:"プロジェクトの作成に失敗しました"}),s}},deleteProject:async s=>{e({isLoading:!0,error:null});try{await a.h.deleteProject(s),e(e=>({projects:e.projects.filter(e=>e.id!==s),isLoading:!1,selectedProjectId:e.selectedProjectId===s?null:e.selectedProjectId}))}catch(s){throw e({isLoading:!1,error:s instanceof Error?s.message:"プロジェクトの削除に失敗しました"}),s}},selectProject:s=>e({selectedProjectId:s}),clearError:()=>e({error:null})}))}},function(e){e.O(0,[945,266,115,364,744],function(){return e(e.s=4196)}),_N_E=e.O()}]);