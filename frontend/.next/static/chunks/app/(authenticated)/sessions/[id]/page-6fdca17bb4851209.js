(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[756],{7064:function(e,s,t){Promise.resolve().then(t.bind(t,8724))},8724:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return J}});var r=t(7821),a=t(8078),n=t(8504),l=t(4790),i=t(4553);let c=(0,i.U)(e=>({messages:[],isLoading:!1,error:null,pendingPermission:null,sessionStatus:null,fetchMessages:async s=>{e({isLoading:!0,error:null});try{let t=await l.h.getMessages(s);e({messages:t,isLoading:!1})}catch(s){e({isLoading:!1,error:s instanceof Error?s.message:"メッセージ一覧の取得に失敗しました"})}},sendMessage:async(s,t)=>{e({isLoading:!0,error:null});try{let r=await l.h.sendMessage(s,t);e(e=>({messages:[...e.messages,r],isLoading:!1}))}catch(s){throw e({isLoading:!1,error:s instanceof Error?s.message:"メッセージの送信に失敗しました"}),s}},respondToPermission:async(s,t,r)=>{e({isLoading:!0,error:null});try{await l.h.respondToPermission(s,t,r),e({pendingPermission:null,isLoading:!1})}catch(s){throw e({isLoading:!1,error:s instanceof Error?s.message:"権限確認の応答に失敗しました"}),s}},setPendingPermission:s=>{e({pendingPermission:s})},addMessage:s=>{e(e=>({messages:[...e.messages,s]}))},setSessionStatus:s=>{e({sessionStatus:s})},setError:s=>{e({error:s})},clearError:()=>e({error:null}),clearMessages:()=>e({messages:[],error:null,pendingPermission:null,sessionStatus:null})})),o=(0,i.U)(e=>({diffResult:null,isLoading:!1,error:null,selectedFile:null,fetchDiff:async s=>{e({isLoading:!0,error:null});try{let t=await l.h.getDiff(s);e({diffResult:t,isLoading:!1})}catch(s){e({isLoading:!1,error:s instanceof Error?s.message:"Diff情報の取得に失敗しました"})}},selectFile:s=>{e({selectedFile:s})},clearDiff:()=>{e({diffResult:null,selectedFile:null,error:null})},clearError:()=>e({error:null})})),d=(0,i.U)(e=>({isLoading:!1,error:null,conflictFiles:null,commits:[],selectedCommit:null,commitDiff:null,rebaseFromMain:async s=>{e({isLoading:!0,error:null,conflictFiles:null});try{let t=await l.h.rebaseFromMain(s);if(t.success)return e({isLoading:!1}),!0;return t.conflict_files&&t.conflict_files.length>0?e({isLoading:!1,conflictFiles:t.conflict_files,error:t.message}):e({isLoading:!1,error:t.message}),!1}catch(s){return e({isLoading:!1,error:s instanceof Error?s.message:"rebaseに失敗しました"}),!1}},squashMerge:async(s,t)=>{e({isLoading:!0,error:null});try{let r=await l.h.squashMerge(s,t);if(r.success)return e({isLoading:!1}),!0;return e({isLoading:!1,error:r.message}),!1}catch(s){return e({isLoading:!1,error:s instanceof Error?s.message:"マージに失敗しました"}),!1}},fetchCommits:async function(s){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;e({isLoading:!0,error:null});try{let r=await l.h.getCommitHistory(s,t);e({commits:r,isLoading:!1})}catch(s){e({isLoading:!1,error:s instanceof Error?s.message:"コミット履歴の取得に失敗しました"})}},fetchCommitDiff:async(s,t)=>{e({isLoading:!0,error:null});try{let r=await l.h.getCommitDiff(s,t);e({commitDiff:r.diff,selectedCommit:t,isLoading:!1})}catch(s){e({isLoading:!1,error:s instanceof Error?s.message:"コミットのdiff取得に失敗しました"})}},resetToCommit:async(s,t)=>{e({isLoading:!0,error:null});try{if((await l.h.resetToCommit(s,t)).success)return e({isLoading:!1}),!0;return e({isLoading:!1,error:"リセットに失敗しました"}),!1}catch(s){return e({isLoading:!1,error:s instanceof Error?s.message:"リセットに失敗しました"}),!1}},selectCommit:s=>{e({selectedCommit:s,commitDiff:null})},clearConflict:()=>{e({conflictFiles:null,error:null})},clearError:()=>{e({error:null})}})),m=t(2949).env.NEXT_PUBLIC_WS_URL||"ws://localhost:8000";var x=t(8694),u=t(3320),h=t(1167),g=t(9245);function b(e){let{title:s,defaultOpen:t=!1,children:n}=e,[l,i]=(0,a.useState)(t),c=()=>{i(!l)};return(0,r.jsxs)("div",{className:"border border-gray-300 rounded-lg my-4 overflow-hidden",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 px-4 py-3 bg-gray-50 cursor-pointer hover:bg-gray-100 transition-colors",onClick:c,onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),c())},role:"button",tabIndex:0,"aria-expanded":l,"aria-controls":"collapsible-content-".concat(s),children:[(0,r.jsx)("span",{className:"text-gray-600 font-mono text-sm select-none",children:l?"▼":"▶"}),(0,r.jsx)("span",{className:"font-medium text-gray-800",children:s})]}),(0,r.jsx)("div",{id:"collapsible-content-".concat(s),className:"overflow-hidden transition-all duration-300 ease-in-out ".concat(l?"max-h-[10000px] opacity-100":"max-h-0 opacity-0"),"aria-hidden":!l,children:(0,r.jsx)("div",{className:"px-4 py-3 bg-white border-t border-gray-200",children:n})})]})}function f(e){let{content:s}=e;if(/^\[(Task|Agent)\]/m.test(s)){let e=function(e){let s=e.split("\n"),t=[],a=null,n=[],l=0,i=()=>{if(n.length>0){let e=n.join("\n").trim();e&&t.push((0,r.jsx)("div",{className:"markdown-content prose prose-sm max-w-none",children:(0,r.jsx)(x.UG,{remarkPlugins:[u.Z],children:e})},"normal-".concat(l++))),n=[]}},c=()=>{if(a){i();let e=a.content.join("\n").trim();t.push((0,r.jsx)(b,{title:a.title,defaultOpen:!1,children:(0,r.jsx)("div",{className:"markdown-content prose prose-sm max-w-none",children:(0,r.jsx)(x.UG,{remarkPlugins:[u.Z],children:e})})},"section-".concat(l++))),a=null}};for(let e of s){let s=e.match(/^\[Task\]\s*(.*)/),t=e.match(/^\[Agent\]\s*(.*)/);s||t?(c(),a={title:s?"Task: ".concat(s[1]):"Agent: ".concat(t[1]),content:[]}):a?a.content.push(e):n.push(e)}return c(),i(),t.length>0?t:[e]}(s);return(0,r.jsx)("div",{className:"space-y-2",children:e})}return(0,r.jsx)("div",{className:"markdown-content prose prose-sm max-w-none",children:(0,r.jsx)(x.UG,{remarkPlugins:[u.Z],components:{code(e){let{className:s,children:t,...a}=e,n=/language-(\w+)/.exec(s||""),l=n?n[1]:"";return!a.inline&&l?(0,r.jsx)(h.Z,{style:g.YC,language:l,PreTag:"div",children:String(t).replace(/\n$/,"")}):(0,r.jsx)("code",{className:"bg-gray-100 text-gray-800 px-1.5 py-0.5 rounded text-sm font-mono",children:t})},pre(e){let{children:s,...t}=e;return(0,r.jsx)("div",{className:"my-4 overflow-x-auto",children:s})},a(e){let{href:s,children:t,...a}=e;return(0,r.jsx)("a",{href:s,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline",...a,children:t})},h1(e){let{children:s,...t}=e;return(0,r.jsx)("h1",{className:"text-2xl font-bold mt-6 mb-4",...t,children:s})},h2(e){let{children:s,...t}=e;return(0,r.jsx)("h2",{className:"text-xl font-bold mt-5 mb-3",...t,children:s})},h3(e){let{children:s,...t}=e;return(0,r.jsx)("h3",{className:"text-lg font-bold mt-4 mb-2",...t,children:s})},p(e){let{children:s,...t}=e;return(0,r.jsx)("p",{className:"mb-4 leading-relaxed",...t,children:s})},ul(e){let{children:s,...t}=e;return(0,r.jsx)("ul",{className:"list-disc list-inside mb-4 space-y-1",...t,children:s})},ol(e){let{children:s,...t}=e;return(0,r.jsx)("ol",{className:"list-decimal list-inside mb-4 space-y-1",...t,children:s})},li(e){let{children:s,...t}=e;return(0,r.jsx)("li",{className:"ml-4",...t,children:s})},blockquote(e){let{children:s,...t}=e;return(0,r.jsx)("blockquote",{className:"border-l-4 border-gray-300 pl-4 italic text-gray-700 my-4",...t,children:s})},table(e){let{children:s,...t}=e;return(0,r.jsx)("div",{className:"overflow-x-auto my-4",children:(0,r.jsx)("table",{className:"min-w-full border border-gray-300",...t,children:s})})},thead(e){let{children:s,...t}=e;return(0,r.jsx)("thead",{className:"bg-gray-100",...t,children:s})},th(e){let{children:s,...t}=e;return(0,r.jsx)("th",{className:"border border-gray-300 px-4 py-2 text-left font-semibold",...t,children:s})},td(e){let{children:s,...t}=e;return(0,r.jsx)("td",{className:"border border-gray-300 px-4 py-2",...t,children:s})},hr(e){let{...s}=e;return(0,r.jsx)("hr",{className:"my-6 border-t border-gray-300",...s})}},children:s})})}function p(e){let{messages:s,isLoading:t}=e,n=(0,a.useRef)(null),l=()=>{var e;null===(e=n.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})};return((0,a.useEffect)(()=>{l()},[s]),t&&0===s.length)?(0,r.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,r.jsx)("p",{className:"text-gray-500",children:"読み込み中..."})}):0===s.length?(0,r.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,r.jsx)("p",{className:"text-gray-500",children:"メッセージがありません"})}):(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[s.map(e=>"system"===e.role?(0,r.jsx)("div",{className:"flex justify-center",children:(0,r.jsx)("div",{className:"bg-gray-100 text-gray-600 px-4 py-2 rounded-lg text-sm max-w-xl text-center",children:e.content})},e.id):"user"===e.role?(0,r.jsx)("div",{className:"flex justify-end",children:(0,r.jsx)("div",{className:"bg-blue-500 text-white px-4 py-2 rounded-lg max-w-xl break-words",children:e.content})},e.id):"assistant"===e.role?(0,r.jsx)("div",{className:"flex justify-start",children:(0,r.jsx)("div",{className:"bg-gray-200 text-gray-900 px-4 py-2 rounded-lg max-w-3xl",children:(0,r.jsx)(f,{content:e.content})})},e.id):null),(0,r.jsx)("div",{ref:n})]})}function y(e){let{onSubmit:s,isLoading:t,disabled:n=!1}=e,[l,i]=(0,a.useState)(""),c=async()=>{if(l.trim()&&!t&&!n)try{await s(l.trim()),i("")}catch(e){console.error("メッセージ送信エラー:",e)}};return(0,r.jsx)("div",{className:"border-t border-gray-200 p-4 bg-white",children:(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("textarea",{value:l,onChange:e=>i(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),c())},placeholder:"メッセージを入力... (Enter: 送信, Shift+Enter: 改行)",disabled:t||n,className:"flex-1 resize-none border border-gray-300 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100 disabled:cursor-not-allowed",rows:3}),(0,r.jsx)("button",{onClick:c,disabled:!l.trim()||t||n,className:"px-6 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:t?"送信中...":"送信"})]})})}var j=t(6633);function N(e){let{permission:s,onApprove:t,onReject:a,isLoading:n}=e;return(0,r.jsxs)(j.Vq,{open:null!==s,onClose:()=>{},className:"relative z-50",children:[(0,r.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,r.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,r.jsxs)(j.EM,{className:"max-w-lg w-full bg-white rounded-lg shadow-xl p-6",children:[(0,r.jsx)(j.$N,{className:"text-lg font-semibold text-gray-900 mb-4",children:"権限確認"}),s&&(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsxs)("p",{className:"text-sm text-gray-600 mb-2",children:[(0,r.jsx)("span",{className:"font-medium",children:"タイプ:"})," ",s.type]}),(0,r.jsx)("p",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:s.description})]}),(0,r.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,r.jsx)("button",{onClick:a,disabled:n,className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 disabled:bg-gray-100 disabled:cursor-not-allowed transition-colors",children:"拒否"}),(0,r.jsx)("button",{onClick:t,disabled:n,className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:"承認"})]})]})})]})}var v=t(4542),w=t(9632);function k(e){let{session:s,projectId:t,onStop:a,isLoading:n}=e,l="running"===s.status||"waiting_input"===s.status;return(0,r.jsx)("div",{className:"border-b border-gray-200 bg-white px-6 py-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)(v.default,{href:"/projects/".concat(t),className:"text-gray-500 hover:text-gray-700 transition-colors",children:"← 戻る"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-xl font-semibold text-gray-900",children:s.name}),(0,r.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,r.jsx)(w.Z,{status:s.status}),(0,r.jsx)("span",{className:"text-sm text-gray-500",children:s.branch_name})]})]})]}),l&&(0,r.jsx)("button",{onClick:a,disabled:n,className:"px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:n?"停止中...":"停止"})]})})}function C(e){let{isConnected:s,isConnecting:t,reconnectAttempts:a}=e;return s?(0,r.jsxs)("div",{className:"flex items-center gap-2 px-3 py-2 bg-green-50 border border-green-200 rounded-md",children:[(0,r.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),(0,r.jsx)("span",{className:"text-sm text-green-700 font-medium",children:"接続中"})]}):t||a>0?(0,r.jsxs)("div",{className:"flex items-center gap-2 px-3 py-2 bg-yellow-50 border border-yellow-200 rounded-md",children:[(0,r.jsx)("div",{className:"w-2 h-2 bg-yellow-500 rounded-full animate-pulse"}),(0,r.jsx)("span",{className:"text-sm text-yellow-700 font-medium",children:a>0?"再接続中 (".concat(a,"/5)"):"接続中..."})]}):(0,r.jsxs)("div",{className:"flex items-center gap-2 px-3 py-2 bg-red-50 border border-red-200 rounded-md",children:[(0,r.jsx)("div",{className:"w-2 h-2 bg-red-500 rounded-full"}),(0,r.jsx)("span",{className:"text-sm text-red-700 font-medium",children:"切断"})]})}function S(e){let{className:s=""}=e,{diffResult:t,selectedFile:a,selectFile:n,isLoading:l}=o();if(l)return(0,r.jsx)("div",{className:"bg-white border-r border-gray-200 overflow-y-auto ".concat(s),children:(0,r.jsx)("div",{className:"p-4 text-sm text-gray-500",children:"読み込み中..."})});if(!t||!t.has_changes)return(0,r.jsx)("div",{className:"bg-white border-r border-gray-200 overflow-y-auto ".concat(s),children:(0,r.jsx)("div",{className:"p-4 text-sm text-gray-500",children:"変更されたファイルがありません"})});let i=e=>{switch(e){case"added":return"text-green-600";case"modified":return"text-yellow-600";case"deleted":return"text-red-600";default:return"text-gray-600"}},c=e=>{switch(e){case"added":return"A";case"modified":return"M";case"deleted":return"D";default:return"?"}};return(0,r.jsxs)("div",{className:"bg-white border-r border-gray-200 overflow-y-auto ".concat(s),children:[(0,r.jsxs)("div",{className:"p-4 border-b border-gray-200",children:[(0,r.jsx)("h3",{className:"text-sm font-semibold text-gray-700",children:"変更されたファイル"}),(0,r.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[t.files.length," 個のファイル"]})]}),(0,r.jsx)("div",{className:"divide-y divide-gray-100",children:t.files.map(e=>(0,r.jsxs)("button",{onClick:()=>n(e.path===a?null:e.path),className:"w-full text-left px-4 py-3 hover:bg-gray-50 transition-colors ".concat(e.path===a?"bg-blue-50":""),children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,r.jsx)("span",{className:"text-xs font-bold ".concat(i(e.status)),children:c(e.status)}),(0,r.jsx)("span",{className:"text-sm text-gray-800 truncate flex-1",title:e.path,children:e.path})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3 text-xs",children:[e.additions>0&&(0,r.jsxs)("span",{className:"text-green-600",children:["+",e.additions]}),e.deletions>0&&(0,r.jsxs)("span",{className:"text-red-600",children:["-",e.deletions]})]})]},e.path))})]})}var L=t(3270),E=t.n(L);function _(e){let{className:s=""}=e,{diffResult:t,selectedFile:a,isLoading:n,error:l}=o();if(n)return(0,r.jsx)("div",{className:"bg-gray-50 overflow-y-auto ".concat(s),children:(0,r.jsx)("div",{className:"p-6 text-center text-gray-500",children:"読み込み中..."})});if(l)return(0,r.jsx)("div",{className:"bg-gray-50 overflow-y-auto ".concat(s),children:(0,r.jsx)("div",{className:"p-6 text-center",children:(0,r.jsx)("p",{className:"text-red-600",children:l})})});if(!t||!t.has_changes)return(0,r.jsx)("div",{className:"bg-gray-50 overflow-y-auto ".concat(s),children:(0,r.jsx)("div",{className:"p-6 text-center text-gray-500",children:"変更がありません"})});let i=function(e){let s=[],t=e.split("\n"),r=null,a=[],n=[];for(let e=0;e<t.length;e++){let l=t[e];if(l.startsWith("diff --git")){r&&(r.oldContent=a.join("\n"),r.newContent=n.join("\n"),s.push(r));let e=l.match(/diff --git a\/(.*?) b\/(.*)/);r={fileName:e?e[2]:"unknown",oldContent:"",newContent:""},a=[],n=[]}else if(l.startsWith("@@"))continue;else if(l.startsWith("---")||l.startsWith("+++"))continue;else if(l.startsWith("-"))a.push(l.substring(1));else if(l.startsWith("+"))n.push(l.substring(1));else if(l.startsWith(" ")){let e=l.substring(1);a.push(e),n.push(e)}}return r&&(r.oldContent=a.join("\n"),r.newContent=n.join("\n"),s.push(r)),s}(t.diff_content),c=a?i.filter(e=>e.fileName===a):i;return 0===c.length?(0,r.jsx)("div",{className:"bg-gray-50 overflow-y-auto ".concat(s),children:(0,r.jsx)("div",{className:"p-6 text-center text-gray-500",children:"選択されたファイルのdiffが見つかりません"})}):(0,r.jsx)("div",{className:"bg-gray-50 overflow-y-auto ".concat(s),children:c.map((e,s)=>(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("div",{className:"bg-gray-100 px-4 py-2 border-b border-gray-300",children:(0,r.jsx)("h4",{className:"text-sm font-mono text-gray-700",children:e.fileName})}),(0,r.jsx)(E(),{oldValue:e.oldContent,newValue:e.newContent,splitView:!1,useDarkTheme:!1,hideLineNumbers:!1,showDiffOnly:!0})]},s))})}function F(e){let{sessionId:s,onSuccess:t}=e,{isLoading:n,rebaseFromMain:l}=d(),[i,c]=(0,a.useState)(null),o=async()=>{c(null),await l(s)&&(c("mainブランチからの取り込みが完了しました"),setTimeout(()=>c(null),3e3),t&&t())};return(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsx)("button",{onClick:o,disabled:n,className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center gap-2",children:n?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("svg",{className:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,r.jsx)("span",{children:"取り込み中..."})]}):"mainから取り込み"}),i&&(0,r.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-md px-4 py-2 text-sm text-green-800",children:i})]})}var P=t(2714),T=t(746);function M(e){let{isOpen:s,onClose:t,sessionId:n,onSuccess:l}=e,{isLoading:i,error:c,squashMerge:o,clearError:m}=d(),{register:x,handleSubmit:u,formState:{errors:h},reset:g}=(0,T.cI)(),b=()=>{g(),m(),t()},f=async e=>{await o(n,e.message)&&(b(),l&&l())};return(0,r.jsx)(P.u,{appear:!0,show:s,as:a.Fragment,children:(0,r.jsxs)(j.Vq,{as:"div",className:"relative z-10",onClose:b,children:[(0,r.jsx)(P.u.Child,{as:a.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-25"})}),(0,r.jsx)("div",{className:"fixed inset-0 overflow-y-auto",children:(0,r.jsx)("div",{className:"flex min-h-full items-center justify-center p-4 text-center",children:(0,r.jsx)(P.u.Child,{as:a.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:(0,r.jsxs)(j.Vq.Panel,{className:"w-full max-w-md transform overflow-hidden rounded-2xl bg-white p-6 text-left align-middle shadow-xl transition-all",children:[(0,r.jsx)(j.Vq.Title,{as:"h3",className:"text-lg font-medium leading-6 text-gray-900",children:"スカッシュしてマージ"}),(0,r.jsxs)("form",{onSubmit:u(f),className:"mt-4",children:[(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{htmlFor:"message",className:"block text-sm font-medium text-gray-700 mb-2",children:"コミットメッセージ"}),(0,r.jsx)("textarea",{id:"message",rows:4,className:"w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",...x("message",{required:"コミットメッセージを入力してください"})}),h.message&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-600",children:h.message.message})]}),c&&(0,r.jsx)("div",{className:"mb-4 bg-red-50 border border-red-200 rounded-md px-4 py-2 text-sm text-red-800",children:c}),(0,r.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,r.jsx)("button",{type:"button",onClick:b,disabled:i,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 disabled:bg-gray-50 disabled:cursor-not-allowed",children:"キャンセル"}),(0,r.jsx)("button",{type:"submit",disabled:i,className:"px-4 py-2 text-sm font-medium text-white bg-blue-500 rounded-md hover:bg-blue-600 disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center gap-2",children:i?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("svg",{className:"animate-spin h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,r.jsx)("span",{children:"マージ中..."})]}):"マージ"})]})]})]})})})})]})})}function W(){let{conflictFiles:e,clearConflict:s}=d(),t=null!==e&&e.length>0;return(0,r.jsx)(P.u,{appear:!0,show:t,as:a.Fragment,children:(0,r.jsxs)(j.Vq,{as:"div",className:"relative z-10",onClose:s,children:[(0,r.jsx)(P.u.Child,{as:a.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-25"})}),(0,r.jsx)("div",{className:"fixed inset-0 overflow-y-auto",children:(0,r.jsx)("div",{className:"flex min-h-full items-center justify-center p-4 text-center",children:(0,r.jsx)(P.u.Child,{as:a.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:(0,r.jsxs)(j.Vq.Panel,{className:"w-full max-w-md transform overflow-hidden rounded-2xl bg-white p-6 text-left align-middle shadow-xl transition-all",children:[(0,r.jsx)(j.Vq.Title,{as:"h3",className:"text-lg font-medium leading-6 text-red-600",children:"コンフリクトが発生しました"}),(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsx)("p",{className:"text-sm text-gray-700 mb-3",children:"以下のファイルでコンフリクトが発生しました。手動で解決してください。"}),(0,r.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-3 max-h-64 overflow-y-auto",children:(0,r.jsx)("ul",{className:"space-y-1",children:null==e?void 0:e.map((e,s)=>(0,r.jsx)("li",{className:"text-sm text-red-800 font-mono",children:e},s))})})]}),(0,r.jsx)("div",{className:"mt-6 flex justify-end",children:(0,r.jsx)("button",{type:"button",onClick:s,className:"px-4 py-2 text-sm font-medium text-white bg-red-500 rounded-md hover:bg-red-600",children:"OK"})})]})})})})]})})}function D(e){let{sessionId:s}=e,{commits:t,selectedCommit:n,commitDiff:l,isLoading:i,error:c,fetchCommits:o,fetchCommitDiff:m,selectCommit:x}=d(),[u,h]=(0,a.useState)(!1),[g,b]=(0,a.useState)(null);(0,a.useEffect)(()=>{o(s)},[s,o]);let f=async e=>{n===e.hash?x(null):await m(s,e.hash)},p=e=>{b(e),h(!0)},y=e=>new Date(e).toLocaleString("ja-JP",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),j=e=>e.substring(0,7);return c?(0,r.jsx)("div",{className:"rounded-md bg-red-50 p-4",children:(0,r.jsx)("p",{className:"text-sm text-red-800",children:c})}):(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold",children:"コミット履歴"}),i&&(0,r.jsx)("div",{className:"text-sm text-gray-500",children:"読み込み中..."})]}),0!==t.length||i?(0,r.jsx)("div",{className:"space-y-2",children:t.map(e=>(0,r.jsxs)("div",{className:"rounded-lg border p-4 transition-colors ".concat(n===e.hash?"border-blue-500 bg-blue-50":"border-gray-200 hover:bg-gray-50"),children:[(0,r.jsx)("div",{className:"cursor-pointer",onClick:()=>f(e),children:(0,r.jsxs)("div",{className:"flex items-start justify-between",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("code",{className:"rounded bg-gray-100 px-2 py-1 text-sm font-mono",children:j(e.hash)}),(0,r.jsx)("p",{className:"text-sm font-medium",children:e.message})]}),(0,r.jsxs)("div",{className:"mt-2 flex items-center gap-4 text-xs text-gray-500",children:[(0,r.jsxs)("span",{children:[e.author_name," <",e.author_email,">"]}),(0,r.jsx)("span",{children:y(e.date)})]})]}),(0,r.jsx)("button",{onClick:s=>{s.stopPropagation(),p(e.hash)},className:"ml-4 rounded-md bg-red-600 px-3 py-1 text-sm font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2",children:"リセット"})]})}),n===e.hash&&l&&(0,r.jsxs)("div",{className:"mt-4 border-t pt-4",children:[(0,r.jsx)("h4",{className:"mb-2 text-sm font-semibold",children:"変更内容"}),(0,r.jsx)("pre",{className:"overflow-x-auto rounded-md bg-gray-900 p-4 text-xs text-gray-100",children:l})]})]},e.hash))}):(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"コミット履歴がありません"}),u&&g&&(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:()=>h(!1),children:(0,r.jsxs)("div",{className:"rounded-lg bg-white p-6 shadow-xl",onClick:e=>e.stopPropagation(),children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"コミットへのリセット"}),(0,r.jsxs)("p",{className:"mt-2 text-sm text-gray-700",children:["このコミット(",j(g),")にリセットします。"]}),(0,r.jsx)("p",{className:"mt-2 text-sm font-semibold text-red-600",children:"この操作は取り消せません。よろしいですか？"}),(0,r.jsxs)("div",{className:"mt-4 flex justify-end gap-2",children:[(0,r.jsx)("button",{onClick:()=>h(!1),className:"rounded-md bg-gray-200 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-300",children:"キャンセル"}),(0,r.jsx)("button",{onClick:async()=>{let{resetToCommit:e}=d.getState();await e(s,g)&&await o(s),h(!1)},className:"rounded-md bg-red-600 px-4 py-2 text-sm font-medium text-white hover:bg-red-700",children:"リセット"})]})]})})]})}var O=t(4549);function R(e){let{output:s}=e,[t,n]=(0,a.useState)({info:!0,warn:!0,error:!0}),[l,i]=(0,a.useState)(""),c=(0,a.useMemo)(()=>s?s.split("\n").map((e,s)=>({text:e,level:function(e){let s=e.toLowerCase();return s.includes("error")||s.includes("fail")?"error":s.includes("warn")?"warn":"info"}(e),lineNumber:s+1})):[],[s]),o=(0,a.useMemo)(()=>c.filter(e=>!(!t[e.level]||l.trim()&&!e.text.toLowerCase().includes(l.toLowerCase()))),[c,t,l]),d=e=>{n(s=>({...s,[e]:!s[e]}))},m=e=>{switch(e){case"error":return"text-red-400";case"warn":return"text-yellow-400";default:return"text-gray-100"}};return(0,r.jsxs)("div",{className:"flex flex-col h-full",children:[(0,r.jsxs)("div",{className:"bg-gray-800 border-b border-gray-700 px-4 py-3 flex items-center gap-4 flex-wrap",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,r.jsx)("input",{type:"checkbox",checked:t.info,onChange:()=>d("info"),className:"rounded border-gray-600 text-blue-500 focus:ring-blue-500"}),(0,r.jsx)("span",{className:"text-sm text-gray-300",children:"Info"})]}),(0,r.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,r.jsx)("input",{type:"checkbox",checked:t.warn,onChange:()=>d("warn"),className:"rounded border-gray-600 text-yellow-500 focus:ring-yellow-500"}),(0,r.jsx)("span",{className:"text-sm text-gray-300",children:"Warn"})]}),(0,r.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,r.jsx)("input",{type:"checkbox",checked:t.error,onChange:()=>d("error"),className:"rounded border-gray-600 text-red-500 focus:ring-red-500"}),(0,r.jsx)("span",{className:"text-sm text-gray-300",children:"Error"})]})]}),(0,r.jsx)("div",{className:"flex-1 min-w-[200px]",children:(0,r.jsx)("input",{type:"text",placeholder:"検索...",value:l,onChange:e=>i(e.target.value),className:"w-full px-3 py-1.5 bg-gray-900 border border-gray-700 rounded-md text-sm text-gray-100 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})})]}),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto bg-gray-900 p-4",children:0===o.length?(0,r.jsx)("div",{className:"text-center text-gray-500 py-8",children:s?"フィルタ条件に一致する行がありません":"(出力なし)"}):(0,r.jsx)("div",{className:"font-mono text-sm",children:o.map(e=>(0,r.jsx)("div",{className:"hover:bg-gray-800/50",children:(0,r.jsx)("span",{className:"".concat(m(e.level)," whitespace-pre-wrap break-words"),children:function(e,s){if(!s.trim())return(0,r.jsx)(r.Fragment,{children:e});let t=[],a=e.toLowerCase(),n=s.toLowerCase(),l=0,i=a.indexOf(n),c=0;for(;-1!==i;)i>l&&t.push((0,r.jsx)("span",{children:e.substring(l,i)},"text-".concat(c++))),t.push((0,r.jsx)("span",{className:"bg-yellow-300 text-gray-900",children:e.substring(i,i+s.length)},"match-".concat(c++))),l=i+s.length,i=a.indexOf(n,l);return l<e.length&&t.push((0,r.jsx)("span",{children:e.substring(l)},"text-".concat(c++))),(0,r.jsx)(r.Fragment,{children:t})}(e.text,l)})},e.lineNumber))})})]})}function z(e){let{sessionId:s,projectId:t}=e,{runScripts:n,fetchRunScripts:i,error:c}=(0,O.Y)(),o=n[t]||[],[d,m]=(0,a.useState)(null),[x,u]=(0,a.useState)(!1),[h,g]=(0,a.useState)(null),[b,f]=(0,a.useState)(null);(0,a.useEffect)(()=>{t&&i(t)},[t,i]);let p=async e=>{m(e),u(!0),f(null),g(null);try{let t=await l.h.executeRunScript(s,e);g(t)}catch(e){f(e instanceof Error?e.message:"スクリプトの実行に失敗しました")}finally{u(!1)}};return c?(0,r.jsx)("div",{className:"p-6",children:(0,r.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:(0,r.jsx)("p",{className:"text-red-800",children:c})})}):0===o.length?(0,r.jsx)("div",{className:"p-6",children:(0,r.jsx)("div",{className:"bg-gray-50 border border-gray-200 rounded-md p-4",children:(0,r.jsx)("p",{className:"text-gray-600",children:"このプロジェクトにはランスクリプトが登録されていません。"})})}):(0,r.jsxs)("div",{className:"flex flex-col h-full",children:[(0,r.jsxs)("div",{className:"border-b border-gray-200 bg-white px-6 py-4",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"ランスクリプト"}),(0,r.jsx)("div",{className:"space-y-2",children:o.map(e=>(0,r.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-md",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("p",{className:"font-medium text-gray-900",children:e.name}),(0,r.jsx)("p",{className:"text-sm text-gray-500 font-mono",children:e.command})]}),(0,r.jsx)("button",{onClick:()=>p(e.id),disabled:x,className:"ml-4 px-4 py-2 rounded-md font-medium ".concat(x?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-500 text-white hover:bg-blue-600"),children:x&&d===e.id?"実行中...":"実行"})]},e.id))})]}),(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 bg-gray-50",children:[b&&(0,r.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4 mb-4",children:(0,r.jsx)("p",{className:"text-red-800",children:b})}),h&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)("div",{className:"px-3 py-1 rounded-md font-medium ".concat(h.success?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:h.success?"成功":"失敗"}),(0,r.jsxs)("div",{className:"text-sm text-gray-600",children:["終了コード: ",(0,r.jsx)("span",{className:"font-mono",children:h.exit_code})]}),(0,r.jsxs)("div",{className:"text-sm text-gray-600",children:["実行時間: ",(0,r.jsxs)("span",{className:"font-mono",children:[h.execution_time.toFixed(2),"秒"]})]})]}),(0,r.jsx)("div",{className:"bg-gray-900 rounded-md overflow-hidden",style:{height:"500px"},children:(0,r.jsx)(R,{output:h.output||""})})]}),!h&&!b&&!x&&(0,r.jsx)("div",{className:"text-center text-gray-500 py-8",children:"スクリプトを選択して実行してください"}),x&&(0,r.jsxs)("div",{className:"text-center text-gray-500 py-8",children:[(0,r.jsx)("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),(0,r.jsx)("p",{className:"mt-2",children:"実行中..."})]})]})]})}var I=t(591);let q=t(2949).env.NEXT_PUBLIC_WS_URL||"ws://localhost:8000",V=(0,I.default)(()=>Promise.resolve(U),{ssr:!1});function U(e){let{sessionId:s}=e,n=(0,a.useRef)(null),l=(0,a.useRef)(null),i=(0,a.useRef)(null),c=(0,a.useRef)(null),[o,d]=(0,a.useState)(!1),[m,x]=(0,a.useState)(null);return(0,a.useEffect)(()=>{let e=!0,r=(async()=>{if(n.current&&e)try{let{Terminal:r}=await t.e(302).then(t.t.bind(t,9101,23)),{FitAddon:a}=await t.e(216).then(t.t.bind(t,6216,23)),o=new r({cursorBlink:!0,fontSize:14,fontFamily:'Menlo, Monaco, "Courier New", monospace',theme:{background:"#1e1e1e",foreground:"#d4d4d4",cursor:"#d4d4d4",black:"#000000",red:"#cd3131",green:"#0dbc79",yellow:"#e5e510",blue:"#2472c8",magenta:"#bc3fbc",cyan:"#11a8cd",white:"#e5e5e5",brightBlack:"#666666",brightRed:"#f14c4c",brightGreen:"#23d18b",brightYellow:"#f5f543",brightBlue:"#3b8eea",brightMagenta:"#d670d6",brightCyan:"#29b8db",brightWhite:"#e5e5e5"},scrollback:1e3}),m=new a;o.loadAddon(m),c.current=m,o.open(n.current),l.current=o,m.fit();let u=new WebSocket("".concat(q,"/ws/sessions/").concat(s,"/terminal"));i.current=u,u.onopen=()=>{e&&(d(!0),x(null),o.writeln("ターミナルに接続しました。"),u.send(JSON.stringify({type:"resize",cols:o.cols,rows:o.rows})))},u.onmessage=s=>{if(e)try{let e=JSON.parse(s.data);switch(e.type){case"output":o.write(e.data);break;case"exit":o.writeln("\r\nプロセスが終了しました (code: ".concat(e.code,")"));break;default:console.warn("Unknown message type:",e.type)}}catch(e){console.error("Failed to parse terminal message:",e)}},u.onerror=()=>{e&&x("ターミナル接続エラーが発生しました")},u.onclose=()=>{e&&(d(!1),o.writeln("\r\nターミナル接続が切断されました。"))},o.onData(e=>{u.readyState===WebSocket.OPEN&&u.send(JSON.stringify({type:"input",data:e}))});let h=()=>{m&&o&&(m.fit(),u.readyState===WebSocket.OPEN&&u.send(JSON.stringify({type:"resize",cols:o.cols,rows:o.rows})))};return window.addEventListener("resize",h),()=>{window.removeEventListener("resize",h),u.close(),o.dispose()}}catch(s){console.error("Failed to initialize terminal:",s),e&&x("ターミナルの初期化に失敗しました")}})();return()=>{e=!1,null==r||r.then(e=>null==e?void 0:e())}},[s]),(0,r.jsxs)("div",{className:"h-full flex flex-col bg-gray-900",children:[(0,r.jsxs)("div",{className:"bg-gray-800 border-b border-gray-700 px-4 py-2 flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("div",{className:"w-2 h-2 rounded-full ".concat(o?"bg-green-500":"bg-red-500")}),(0,r.jsx)("span",{className:"text-sm text-gray-300",children:o?"接続済み":"切断"})]}),m&&(0,r.jsx)("span",{className:"text-sm text-red-400",children:m})]}),(0,r.jsx)("div",{className:"flex-1 p-2 overflow-hidden",children:(0,r.jsx)("div",{ref:n,className:"h-full"})})]})}function A(e){return(0,r.jsx)(V,{...e})}function B(){return"".concat(Date.now(),"-").concat(Math.random().toString(36).substring(2,9))}function J(){let e=(0,n.useParams)(),s=(0,n.useRouter)(),t=e.id,{messages:i,isLoading:x,error:u,pendingPermission:h,sessionStatus:g,fetchMessages:b,sendMessage:f,respondToPermission:j,clearError:v,clearMessages:w,addMessage:L,setSessionStatus:E,setPendingPermission:P,setError:T}=c(),[O,R]=(0,a.useState)(null),[I,q]=(0,a.useState)(!0),[V,U]=(0,a.useState)(null),[J,Z]=(0,a.useState)(!1),[G,K]=(0,a.useState)("chat"),[H,Y]=(0,a.useState)(!1),{fetchDiff:X,clearDiff:$}=o(),{error:Q,clearError:ee}=d(),es=(0,a.useCallback)(e=>{switch(e.type){case"assistant_output":L({id:B(),session_id:t,role:"assistant",content:e.content,created_at:new Date().toISOString()});break;case"permission_request":P({id:e.permission_id,type:"permission",description:e.description});break;case"session_status":E(e.status),R(s=>s?{...s,status:e.status}:null);break;case"error":T(e.message)}},[t,L,P,E,T]),{isConnected:et,isConnecting:er,reconnectAttempts:ea,sendMessage:en}=function(e){let{sessionId:s,onMessage:t,onConnectionChange:r,enabled:n=!0}=e,[l,i]=(0,a.useState)(!1),[c,o]=(0,a.useState)(!1),[d,x]=(0,a.useState)(0),u=(0,a.useRef)(null),h=(0,a.useRef)(null),g=(0,a.useRef)(!0),b=(0,a.useRef)(n);(0,a.useEffect)(()=>{b.current=n},[n]);let f=(0,a.useCallback)(()=>{g.current=!1,h.current&&(clearTimeout(h.current),h.current=null),u.current&&(u.current.close(),u.current=null),i(!1),o(!1)},[]),p=(0,a.useCallback)(()=>{var e;if(b.current&&(null===(e=u.current)||void 0===e?void 0:e.readyState)!==WebSocket.OPEN&&!c){h.current&&(clearTimeout(h.current),h.current=null),o(!0),g.current=!0;try{let e=new WebSocket("".concat(m,"/ws/sessions/").concat(s));e.onopen=()=>{i(!0),o(!1),x(0),null==r||r(!0)},e.onclose=()=>{if(i(!1),o(!1),null==r||r(!1),b.current&&g.current&&d<5){let e=Math.min(1e3*Math.pow(2,d),16e3);h.current=setTimeout(()=>{x(e=>e+1),p()},e)}},e.onerror=()=>{},e.onmessage=e=>{try{let s=JSON.parse(e.data);t(s)}catch(e){console.error("Failed to parse WebSocket message:",e)}},u.current=e}catch(e){console.error("Failed to create WebSocket connection:",e),o(!1)}}},[s,d,c,t,r]),y=(0,a.useCallback)(e=>{var s;(null===(s=u.current)||void 0===s?void 0:s.readyState)===WebSocket.OPEN?u.current.send(JSON.stringify(e)):console.warn("WebSocket is not connected. Cannot send message.")},[]);return(0,a.useEffect)(()=>(n?p():f(),()=>{g.current=!1,h.current&&(clearTimeout(h.current),h.current=null),u.current&&(u.current.close(),u.current=null)}),[n,p,f]),{isConnected:l,isConnecting:c,reconnectAttempts:d,sendMessage:y,disconnect:f,connect:p}}({sessionId:t,onMessage:es,enabled:!!t});(0,a.useEffect)(()=>((async()=>{try{let e=await l.h.getSession(t);R(e),E(e.status),q(!1)}catch(e){U(e instanceof Error?e.message:"セッションの取得に失敗しました"),q(!1)}})(),b(t),()=>{w(),$()}),[t,w,$,b,E]),(0,a.useEffect)(()=>{"changes"===G&&t&&X(t)},[G,t,X]);let el=async e=>{et?(L({id:B(),session_id:t,role:"user",content:e,created_at:new Date().toISOString()}),en({type:"user_input",content:e})):await f(t,e)},ei=async()=>{Z(!0);try{await l.h.stopSession(t);let e=await l.h.getSession(t);R(e),E(e.status)}catch(e){U(e instanceof Error?e.message:"セッションの停止に失敗しました")}finally{Z(!1)}},ec=async()=>{if(h){if(et)en({type:"permission_response",permission_id:h.id,approved:!0}),P(null);else try{await j(t,h.id,!0)}catch(e){console.error("権限承認エラー:",e)}}},eo=async()=>{if(h){if(et)en({type:"permission_response",permission_id:h.id,approved:!1}),P(null);else try{await j(t,h.id,!1)}catch(e){console.error("権限拒否エラー:",e)}}};return I?(0,r.jsx)("div",{className:"flex items-center justify-center h-screen",children:(0,r.jsx)("p",{className:"text-gray-500",children:"読み込み中..."})}):V||!O?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center h-screen",children:[(0,r.jsx)("p",{className:"text-red-600 mb-4",children:V||"セッションが見つかりません"}),(0,r.jsx)("button",{onClick:()=>s.back(),className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600",children:"戻る"})]}):(0,r.jsxs)("div",{className:"flex flex-col h-screen",children:[(0,r.jsx)(k,{session:O,projectId:O.project_id,onStop:ei,isLoading:J}),(0,r.jsx)("div",{className:"border-b border-gray-200 bg-white px-6 py-3",children:(0,r.jsx)(C,{isConnected:et,isConnecting:er,reconnectAttempts:ea})}),u&&(0,r.jsx)("div",{className:"bg-red-50 border-b border-red-200 px-6 py-3",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("p",{className:"text-sm text-red-800",children:u}),(0,r.jsx)("button",{onClick:v,className:"text-red-600 hover:text-red-800 text-sm font-medium",children:"閉じる"})]})}),Q&&(0,r.jsx)("div",{className:"bg-red-50 border-b border-red-200 px-6 py-3",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("p",{className:"text-sm text-red-800",children:Q}),(0,r.jsx)("button",{onClick:ee,className:"text-red-600 hover:text-red-800 text-sm font-medium",children:"閉じる"})]})}),(0,r.jsx)("div",{className:"border-b border-gray-200 bg-white",children:(0,r.jsxs)("div",{className:"flex",children:[(0,r.jsx)("button",{onClick:()=>K("chat"),className:"px-6 py-3 text-sm font-medium border-b-2 transition-colors ".concat("chat"===G?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"チャット"}),(0,r.jsx)("button",{onClick:()=>K("changes"),className:"px-6 py-3 text-sm font-medium border-b-2 transition-colors ".concat("changes"===G?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"変更"}),(0,r.jsx)("button",{onClick:()=>K("history"),className:"px-6 py-3 text-sm font-medium border-b-2 transition-colors ".concat("history"===G?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"履歴"}),(0,r.jsx)("button",{onClick:()=>K("scripts"),className:"px-6 py-3 text-sm font-medium border-b-2 transition-colors ".concat("scripts"===G?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"スクリプト"}),(0,r.jsx)("button",{onClick:()=>K("terminal"),className:"px-6 py-3 text-sm font-medium border-b-2 transition-colors ".concat("terminal"===G?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"ターミナル"})]})}),(0,r.jsx)("div",{className:"flex-1 overflow-hidden",children:"chat"===G?(0,r.jsxs)("div",{className:"flex flex-col h-full",children:[(0,r.jsx)(p,{messages:i,isLoading:x}),(0,r.jsx)(y,{onSubmit:el,isLoading:x,disabled:!et||"waiting_input"!==g&&"running"!==g})]}):"changes"===G?(0,r.jsxs)("div",{className:"flex flex-col h-full",children:[(0,r.jsx)("div",{className:"border-b border-gray-200 bg-white px-6 py-4",children:(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsx)(F,{sessionId:t,onSuccess:()=>{X(t)}}),(0,r.jsx)("button",{onClick:()=>Y(!0),className:"px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600",children:"スカッシュしてマージ"})]})}),(0,r.jsxs)("div",{className:"flex flex-1 overflow-hidden",children:[(0,r.jsx)(S,{className:"w-80 flex-shrink-0"}),(0,r.jsx)(_,{className:"flex-1"})]})]}):"scripts"===G?(0,r.jsx)("div",{className:"h-full",children:(0,r.jsx)(z,{sessionId:t,projectId:O.project_id})}):"terminal"===G?(0,r.jsx)("div",{className:"h-full",children:(0,r.jsx)(A,{sessionId:t})}):(0,r.jsx)("div",{className:"h-full overflow-y-auto px-6 py-4",children:(0,r.jsx)(D,{sessionId:t})})}),(0,r.jsx)(N,{permission:h,onApprove:ec,onReject:eo,isLoading:x}),(0,r.jsx)(M,{isOpen:H,onClose:()=>Y(!1),sessionId:t,onSuccess:()=>{O&&s.push("/projects/".concat(O.project_id))}}),(0,r.jsx)(W,{})]})}}},function(e){e.O(0,[945,633,749,266,115,364,744],function(){return e(e.s=7064)}),_N_E=e.O()}]);